"use strict";(self.webpackChunkpersonal_blog=self.webpackChunkpersonal_blog||[]).push([["3261"],{64485:function(e,n,o){o.r(n),o.d(n,{default:()=>h,frontMatter:()=>t,metadata:()=>r,assets:()=>a,toc:()=>l,contentTitle:()=>c});var r=JSON.parse('{"id":"Clippings/Daemon proxy configuration","title":"Daemon proxy configuration","description":"Learn how to configure the Docker daemon to use an HTTP proxy","source":"@site/collections/Clippings/Daemon proxy configuration.md","sourceDirName":"Clippings","slug":"/Clippings/Daemon proxy configuration","permalink":"/zh-CN/collections/Clippings/Daemon proxy configuration","draft":false,"unlisted":false,"tags":[{"inline":true,"label":"clippings","permalink":"/zh-CN/collections/tags/clippings"}],"version":"current","frontMatter":{"title":"Daemon proxy configuration","source":"https://docs.docker.com/engine/daemon/proxy/","author":["[[Docker Documentation]]"],"published":"2024-11-05T00:00:00.000Z","created":"2025-03-10T00:00:00.000Z","description":"Learn how to configure the Docker daemon to use an HTTP proxy","tags":["clippings"]},"sidebar":"readings","previous":{"title":"Buffett\'s quotes from Berkshire meeting: Stepping aside as CEO, trade, opportunities, United States","permalink":"/zh-CN/collections/Clippings/Buffett\'s quotes from Berkshire meeting Stepping aside as CEO, trade, opportunities, United States"},"next":{"title":"Proxy configuration","permalink":"/zh-CN/collections/Clippings/Docker Cli Proxy configuration"}}'),s=o("85893"),i=o("50065");let t={title:"Daemon proxy configuration",source:"https://docs.docker.com/engine/daemon/proxy/",author:["[[Docker Documentation]]"],published:new Date("2024-11-05T00:00:00.000Z"),created:new Date("2025-03-10T00:00:00.000Z"),description:"Learn how to configure the Docker daemon to use an HTTP proxy",tags:["clippings"]},c=void 0,a={},l=[{value:"Daemon configuration",id:"daemon-configuration",level:2},{value:"Environment variables",id:"environment-variables",level:2},{value:"systemd unit file",id:"systemd-unit-file",level:3}];function d(e){let n={a:"a",blockquote:"blockquote",code:"code",h2:"h2",h3:"h3",hr:"hr",li:"li",ol:"ol",p:"p",pre:"pre",strong:"strong",ul:"ul",...(0,i.a)(),...e.components};return(0,s.jsxs)(s.Fragment,{children:[(0,s.jsx)(n.p,{children:"Table of contents"}),"\n",(0,s.jsx)(n.hr,{}),"\n",(0,s.jsx)(n.p,{children:"If your organization uses a proxy server to connect to the internet, you may need to configure the Docker daemon to use the proxy server. The daemon uses a proxy server to access images stored on Docker Hub and other registries, and to reach other nodes in a Docker swarm."}),"\n",(0,s.jsxs)(n.p,{children:["This page describes how to configure a proxy for the Docker daemon. For instructions on configuring proxy settings for the Docker CLI, see ",(0,s.jsx)(n.a,{href:"https://docs.docker.com/engine/cli/proxy/",children:"Configure Docker CLI to use a proxy server"}),"."]}),"\n",(0,s.jsxs)(n.blockquote,{children:["\n",(0,s.jsx)(n.p,{children:(0,s.jsx)(n.strong,{children:"Important"})}),"\n",(0,s.jsxs)(n.p,{children:["Proxy configurations specified in the ",(0,s.jsx)(n.code,{children:"daemon.json"})," are ignored by Docker Desktop. If you use Docker Desktop, you can configure proxies using the ",(0,s.jsx)(n.a,{href:"https://docs.docker.com/desktop/settings-and-maintenance/settings/#proxies",children:"Docker Desktop settings"}),"."]}),"\n"]}),"\n",(0,s.jsx)(n.p,{children:"There are two ways you can configure these settings:"}),"\n",(0,s.jsxs)(n.ul,{children:["\n",(0,s.jsxs)(n.li,{children:[(0,s.jsx)(n.a,{href:"https://docs.docker.com/engine/daemon/proxy/#daemon-configuration",children:"Configuring the daemon"})," through a configuration file or CLI flags"]}),"\n",(0,s.jsxs)(n.li,{children:["Setting ",(0,s.jsx)(n.a,{href:"https://docs.docker.com/engine/daemon/proxy/#environment-variables",children:"environment variables"})," on the system"]}),"\n"]}),"\n",(0,s.jsx)(n.p,{children:"Configuring the daemon directly takes precedence over environment variables."}),"\n",(0,s.jsx)(n.h2,{id:"daemon-configuration",children:"Daemon configuration"}),"\n",(0,s.jsxs)(n.p,{children:["You may configure proxy behavior for the daemon in the ",(0,s.jsx)(n.code,{children:"daemon.json"})," file, or using CLI flags for the ",(0,s.jsx)(n.code,{children:"--http-proxy"})," or ",(0,s.jsx)(n.code,{children:"--https-proxy"})," flags for the ",(0,s.jsx)(n.code,{children:"dockerd"})," command. Configuration using ",(0,s.jsx)(n.code,{children:"daemon.json"})," is recommended."]}),"\n",(0,s.jsx)(n.pre,{children:(0,s.jsx)(n.code,{className:"language-json",children:'{\n  "proxies": {\n    "http-proxy": "http://proxy.example.com:3128",\n    "https-proxy": "https://proxy.example.com:3129",\n    "no-proxy": "*.test.example.com,.example.org,127.0.0.0/8"\n  }\n}\n'})}),"\n",(0,s.jsx)(n.p,{children:"After changing the configuration file, restart the daemon for the proxy configuration to take effect:"}),"\n",(0,s.jsx)(n.pre,{children:(0,s.jsx)(n.code,{className:"language-console",children:"$ sudo systemctl restart docker\n"})}),"\n",(0,s.jsx)(n.h2,{id:"environment-variables",children:"Environment variables"}),"\n",(0,s.jsx)(n.p,{children:"The Docker daemon checks the following environment variables in its start-up environment to configure HTTP or HTTPS proxy behavior:"}),"\n",(0,s.jsxs)(n.ul,{children:["\n",(0,s.jsx)(n.li,{children:(0,s.jsx)(n.code,{children:"HTTP_PROXY"})}),"\n",(0,s.jsx)(n.li,{children:(0,s.jsx)(n.code,{children:"http_proxy"})}),"\n",(0,s.jsx)(n.li,{children:(0,s.jsx)(n.code,{children:"HTTPS_PROXY"})}),"\n",(0,s.jsx)(n.li,{children:(0,s.jsx)(n.code,{children:"https_proxy"})}),"\n",(0,s.jsx)(n.li,{children:(0,s.jsx)(n.code,{children:"NO_PROXY"})}),"\n",(0,s.jsx)(n.li,{children:(0,s.jsx)(n.code,{children:"no_proxy"})}),"\n"]}),"\n",(0,s.jsx)(n.h3,{id:"systemd-unit-file",children:"systemd unit file"}),"\n",(0,s.jsxs)(n.p,{children:["If you're running the Docker daemon as a systemd service, you can create a systemd drop-in file that sets the variables for the ",(0,s.jsx)(n.code,{children:"docker"})," service."]}),"\n",(0,s.jsxs)(n.blockquote,{children:["\n",(0,s.jsx)(n.p,{children:(0,s.jsx)(n.strong,{children:"Note for rootless mode"})}),"\n",(0,s.jsxs)(n.p,{children:["The location of systemd configuration files are different when running Docker in ",(0,s.jsx)(n.a,{href:"https://docs.docker.com/engine/security/rootless/",children:"rootless mode"}),". When running in rootless mode, Docker is started as a user-mode systemd service, and uses files stored in each users' home directory in ",(0,s.jsx)(n.code,{children:"~/.config/systemd/<user>/docker.service.d/"}),". In addition, ",(0,s.jsx)(n.code,{children:"systemctl"})," must be executed without ",(0,s.jsx)(n.code,{children:"sudo"})," and with the ",(0,s.jsx)(n.code,{children:"--user"}),' flag. Select the "Rootless mode" tab if you are running Docker in rootless mode.']}),"\n"]}),"\n",(0,s.jsx)(n.hr,{}),"\n",(0,s.jsxs)(n.ol,{children:["\n",(0,s.jsxs)(n.li,{children:["Create a systemd drop-in directory for the ",(0,s.jsx)(n.code,{children:"docker"})," service:"]}),"\n"]}),"\n",(0,s.jsx)(n.pre,{children:(0,s.jsx)(n.code,{className:"language-console",children:"$ sudo mkdir -p /etc/systemd/system/docker.service.d\n"})}),"\n",(0,s.jsxs)(n.ol,{start:"2",children:["\n",(0,s.jsxs)(n.li,{children:["Create a file named ",(0,s.jsx)(n.code,{children:"/etc/systemd/system/docker.service.d/http-proxy.conf"})," that adds the ",(0,s.jsx)(n.code,{children:"HTTP_PROXY"})," environment variable:"]}),"\n"]}),"\n",(0,s.jsx)(n.pre,{children:(0,s.jsx)(n.code,{className:"language-systemd",children:'[Service]\nEnvironment="HTTP_PROXY=http://proxy.example.com:3128"\n'})}),"\n",(0,s.jsxs)(n.p,{children:["If you are behind an HTTPS proxy server, set the ",(0,s.jsx)(n.code,{children:"HTTPS_PROXY"})," environment variable:"]}),"\n",(0,s.jsx)(n.pre,{children:(0,s.jsx)(n.code,{className:"language-systemd",children:'[Service]\nEnvironment="HTTPS_PROXY=https://proxy.example.com:3129"\n'})}),"\n",(0,s.jsx)(n.p,{children:"Multiple environment variables can be set; to set both a non-HTTPS and a HTTPs proxy;"}),"\n",(0,s.jsx)(n.pre,{children:(0,s.jsx)(n.code,{className:"language-systemd",children:'[Service]\nEnvironment="HTTP_PROXY=http://proxy.example.com:3128"\nEnvironment="HTTPS_PROXY=https://proxy.example.com:3129"\n'})}),"\n",(0,s.jsxs)(n.blockquote,{children:["\n",(0,s.jsx)(n.p,{children:(0,s.jsx)(n.strong,{children:"Note"})}),"\n",(0,s.jsxs)(n.p,{children:["Special characters in the proxy value, such as ",(0,s.jsx)(n.code,{children:"#?!()[]{}"}),", must be double escaped using ",(0,s.jsx)(n.code,{children:"%%"}),". For example:"]}),"\n",(0,s.jsx)(n.pre,{children:(0,s.jsx)(n.code,{className:"language-systemd",children:'[Service]\nEnvironment="HTTP_PROXY=http://domain%%5Cuser:complex%%23pass@proxy.example.com:3128/"\n'})}),"\n"]}),"\n",(0,s.jsxs)(n.ol,{start:"3",children:["\n",(0,s.jsxs)(n.li,{children:["If you have internal Docker registries that you need to contact without proxying, you can specify them via the ",(0,s.jsx)(n.code,{children:"NO_PROXY"})," environment variable."]}),"\n"]}),"\n",(0,s.jsxs)(n.p,{children:["The ",(0,s.jsx)(n.code,{children:"NO_PROXY"})," variable specifies a string that contains comma-separated values for hosts that should be excluded from proxying. These are the options you can specify to exclude hosts:"]}),"\n",(0,s.jsxs)(n.ul,{children:["\n",(0,s.jsxs)(n.li,{children:["IP address prefix (",(0,s.jsx)(n.code,{children:"1.2.3.4"}),")"]}),"\n",(0,s.jsxs)(n.li,{children:["Domain name, or a special DNS label (",(0,s.jsx)(n.code,{children:"*"}),")"]}),"\n",(0,s.jsxs)(n.li,{children:['A domain name matches that name and all subdomains. A domain name with a leading "." matches subdomains only. For example, given the domains ',(0,s.jsx)(n.code,{children:"foo.example.com"})," and ",(0,s.jsx)(n.code,{children:"example.com"}),":"]}),"\n",(0,s.jsxs)(n.li,{children:[(0,s.jsx)(n.code,{children:"example.com"})," matches ",(0,s.jsx)(n.code,{children:"example.com"})," and ",(0,s.jsx)(n.code,{children:"foo.example.com"}),", and"]}),"\n",(0,s.jsxs)(n.li,{children:[(0,s.jsx)(n.code,{children:".example.com"})," matches only ",(0,s.jsx)(n.code,{children:"foo.example.com"})]}),"\n",(0,s.jsxs)(n.li,{children:["A single asterisk (",(0,s.jsx)(n.code,{children:"*"}),") indicates that no proxying should be done"]}),"\n",(0,s.jsxs)(n.li,{children:["Literal port numbers are accepted by IP address prefixes (",(0,s.jsx)(n.code,{children:"1.2.3.4:80"}),") and domain names (",(0,s.jsx)(n.code,{children:"foo.example.com:80"}),")"]}),"\n"]}),"\n",(0,s.jsx)(n.p,{children:"Example:"}),"\n",(0,s.jsx)(n.pre,{children:(0,s.jsx)(n.code,{className:"language-systemd",children:'[Service]\nEnvironment="HTTP_PROXY=http://proxy.example.com:3128"\nEnvironment="HTTPS_PROXY=https://proxy.example.com:3129"\nEnvironment="NO_PROXY=localhost,127.0.0.1,docker-registry.example.com,.corp"\n'})}),"\n",(0,s.jsxs)(n.ol,{start:"4",children:["\n",(0,s.jsx)(n.li,{children:"Flush changes and restart Docker"}),"\n"]}),"\n",(0,s.jsx)(n.pre,{children:(0,s.jsx)(n.code,{className:"language-console",children:"$ sudo systemctl daemon-reload\n$ sudo systemctl restart docker\n"})}),"\n",(0,s.jsxs)(n.ol,{start:"5",children:["\n",(0,s.jsx)(n.li,{children:"Verify that the configuration has been loaded and matches the changes you made, for example:"}),"\n"]}),"\n",(0,s.jsx)(n.pre,{children:(0,s.jsx)(n.code,{className:"language-console",children:"$ sudo systemctl show --property=Environment docker\nEnvironment=HTTP_PROXY=http://proxy.example.com:3128 HTTPS_PROXY=https://proxy.example.com:3129 NO_PROXY=localhost,127.0.0.1,docker-registry.example.com,.corp\n"})}),"\n",(0,s.jsx)(n.hr,{})]})}function h(e={}){let{wrapper:n}={...(0,i.a)(),...e.components};return n?(0,s.jsx)(n,{...e,children:(0,s.jsx)(d,{...e})}):d(e)}},50065:function(e,n,o){o.d(n,{Z:function(){return c},a:function(){return t}});var r=o(67294);let s={},i=r.createContext(s);function t(e){let n=r.useContext(i);return r.useMemo(function(){return"function"==typeof e?e(n):{...n,...e}},[n,e])}function c(e){let n;return n=e.disableParentContext?"function"==typeof e.components?e.components(s):e.components||s:t(e.components),r.createElement(i.Provider,{value:n},e.children)}}}]);