"use strict";(self.webpackChunkpersonal_blog=self.webpackChunkpersonal_blog||[]).push([[7042],{28453:(e,n,l)=>{l.d(n,{R:()=>r,x:()=>c});var i=l(96540);const t={},s=i.createContext(t);function r(e){const n=i.useContext(s);return i.useMemo((function(){return"function"==typeof e?e(n):{...n,...e}}),[n,e])}function c(e){let n;return n=e.disableParentContext?"function"==typeof e.components?e.components(t):e.components||t:r(e.components),i.createElement(s.Provider,{value:n},e.children)}},31058:(e,n,l)=>{l.r(n),l.d(n,{assets:()=>d,contentTitle:()=>c,default:()=>o,frontMatter:()=>r,metadata:()=>i,toc:()=>a});const i=JSON.parse('{"id":"Zettelkasten/\u672c\u5730\u542f\u52a8 etcd \u96c6\u7fa4","title":"\u672c\u5730\u542f\u52a8 etcd \u96c6\u7fa4","description":"\u4ee5\u4e0b\u662f\u5c06\u4e09\u8282\u70b9 etcd \u96c6\u7fa4\u7684\u542f\u52a8\u547d\u4ee4\u6539\u4e3a\u5355\u884c\u5f62\u5f0f\uff0c\u5e76\u786e\u4fdd\u524d\u53f0\u8fd0\u884c\uff08\u4e0d\u52a0 & \u540e\u53f0\u8fd0\u884c\uff09\u3002\u7531\u4e8e\u662f\u5355\u884c\u547d\u4ee4\uff0c\u4f60\u9700\u8981\u5728\u4e00\u4e2a\u7ec8\u7aef\u7a97\u53e3\u8fd0\u884c\u4e00\u4e2a\u8282\u70b9\uff0c\u7136\u540e\u53e6\u5f00\u7a97\u53e3\u8fd0\u884c\u5176\u4ed6\u8282\u70b9\uff0c\u6216\u8005\u7528\u811a\u672c\u5206\u6b65\u6267\u884c\u3002\u8fd9\u91cc\u63d0\u4f9b\u6bcf\u4e2a\u8282\u70b9\u7684\u524d\u53f0\u5355\u884c\u547d\u4ee4\uff0c\u65b9\u4fbf\u590d\u5236\u7c98\u8d34\uff1a","source":"@site/knowledges/Zettelkasten/\u672c\u5730\u542f\u52a8 etcd \u96c6\u7fa4.md","sourceDirName":"Zettelkasten","slug":"/Zettelkasten/\u672c\u5730\u542f\u52a8 etcd \u96c6\u7fa4","permalink":"/zh-CN/knowledges/Zettelkasten/\u672c\u5730\u542f\u52a8 etcd \u96c6\u7fa4","draft":false,"unlisted":false,"tags":[],"version":"current","frontMatter":{},"sidebar":"readings","previous":{"title":"zabbix \u90e8\u7f72","permalink":"/zh-CN/knowledges/Zettelkasten/zabbix \u90e8\u7f72"},"next":{"title":"All My Knowledges","permalink":"/zh-CN/knowledges/"}}');var t=l(74848),s=l(28453);const r={},c=void 0,d={},a=[{value:"\u5355\u884c\u547d\u4ee4\uff08\u524d\u53f0\u8fd0\u884c\uff09",id:"\u5355\u884c\u547d\u4ee4\u524d\u53f0\u8fd0\u884c",level:3},{value:"\u8282\u70b9 1\uff08infra0\uff09",id:"\u8282\u70b9-1infra0",level:4},{value:"\u8282\u70b9 2\uff08infra1\uff09",id:"\u8282\u70b9-2infra1",level:4},{value:"\u8282\u70b9 3\uff08infra2\uff09",id:"\u8282\u70b9-3infra2",level:4},{value:"\u64cd\u4f5c\u6b65\u9aa4",id:"\u64cd\u4f5c\u6b65\u9aa4",level:3},{value:"\u6ce8\u610f\u4e8b\u9879",id:"\u6ce8\u610f\u4e8b\u9879",level:3},{value:"\u5982\u679c\u9700\u8981\u5355\u7ec8\u7aef\u8fd0\u884c",id:"\u5982\u679c\u9700\u8981\u5355\u7ec8\u7aef\u8fd0\u884c",level:3},{value:"\u9a8c\u8bc1",id:"\u9a8c\u8bc1",level:3}];function h(e){const n={code:"code",h3:"h3",h4:"h4",hr:"hr",li:"li",ol:"ol",p:"p",pre:"pre",strong:"strong",ul:"ul",...(0,s.R)(),...e.components};return(0,t.jsxs)(t.Fragment,{children:[(0,t.jsxs)(n.p,{children:["\u4ee5\u4e0b\u662f\u5c06\u4e09\u8282\u70b9 etcd \u96c6\u7fa4\u7684\u542f\u52a8\u547d\u4ee4\u6539\u4e3a\u5355\u884c\u5f62\u5f0f\uff0c\u5e76\u786e\u4fdd\u524d\u53f0\u8fd0\u884c\uff08\u4e0d\u52a0 ",(0,t.jsx)(n.code,{children:"&"})," \u540e\u53f0\u8fd0\u884c\uff09\u3002\u7531\u4e8e\u662f\u5355\u884c\u547d\u4ee4\uff0c\u4f60\u9700\u8981\u5728\u4e00\u4e2a\u7ec8\u7aef\u7a97\u53e3\u8fd0\u884c\u4e00\u4e2a\u8282\u70b9\uff0c\u7136\u540e\u53e6\u5f00\u7a97\u53e3\u8fd0\u884c\u5176\u4ed6\u8282\u70b9\uff0c\u6216\u8005\u7528\u811a\u672c\u5206\u6b65\u6267\u884c\u3002\u8fd9\u91cc\u63d0\u4f9b\u6bcf\u4e2a\u8282\u70b9\u7684\u524d\u53f0\u5355\u884c\u547d\u4ee4\uff0c\u65b9\u4fbf\u590d\u5236\u7c98\u8d34\uff1a"]}),"\n",(0,t.jsx)(n.hr,{}),"\n",(0,t.jsx)(n.h3,{id:"\u5355\u884c\u547d\u4ee4\u524d\u53f0\u8fd0\u884c",children:"\u5355\u884c\u547d\u4ee4\uff08\u524d\u53f0\u8fd0\u884c\uff09"}),"\n",(0,t.jsx)(n.h4,{id:"\u8282\u70b9-1infra0",children:"\u8282\u70b9 1\uff08infra0\uff09"}),"\n",(0,t.jsx)(n.pre,{children:(0,t.jsx)(n.code,{className:"language-bash",children:"etcd --name infra0 --data-dir etcd-cluster/infra0 --listen-client-urls http://127.0.0.1:2379 --advertise-client-urls http://127.0.0.1:2379 --listen-peer-urls http://127.0.0.1:2380 --initial-advertise-peer-urls http://127.0.0.1:2380 --initial-cluster infra0=http://127.0.0.1:2380,infra1=http://127.0.0.1:2381,infra2=http://127.0.0.1:2382 --initial-cluster-token etcd-cluster-1 --initial-cluster-state new --log-level info --logger zap\n"})}),"\n",(0,t.jsx)(n.h4,{id:"\u8282\u70b9-2infra1",children:"\u8282\u70b9 2\uff08infra1\uff09"}),"\n",(0,t.jsx)(n.pre,{children:(0,t.jsx)(n.code,{className:"language-bash",children:"etcd --name infra1 --data-dir etcd-cluster/infra1 --listen-client-urls http://127.0.0.1:2479 --advertise-client-urls http://127.0.0.1:2479 --listen-peer-urls http://127.0.0.1:2381 --initial-advertise-peer-urls http://127.0.0.1:2381 --initial-cluster infra0=http://127.0.0.1:2380,infra1=http://127.0.0.1:2381,infra2=http://127.0.0.1:2382 --initial-cluster-token etcd-cluster-1 --initial-cluster-state new --log-level info --logger zap\n"})}),"\n",(0,t.jsx)(n.h4,{id:"\u8282\u70b9-3infra2",children:"\u8282\u70b9 3\uff08infra2\uff09"}),"\n",(0,t.jsx)(n.pre,{children:(0,t.jsx)(n.code,{className:"language-bash",children:"etcd --name infra2 --data-dir etcd-cluster/infra2 --listen-client-urls http://127.0.0.1:2579 --advertise-client-urls http://127.0.0.1:2579 --listen-peer-urls http://127.0.0.1:2382 --initial-advertise-peer-urls http://127.0.0.1:2382 --initial-cluster infra0=http://127.0.0.1:2380,infra1=http://127.0.0.1:2381,infra2=http://127.0.0.1:2382 --initial-cluster-token etcd-cluster-1 --initial-cluster-state new --log-level info --logger zap\n"})}),"\n",(0,t.jsx)(n.hr,{}),"\n",(0,t.jsx)(n.h3,{id:"\u64cd\u4f5c\u6b65\u9aa4",children:"\u64cd\u4f5c\u6b65\u9aa4"}),"\n",(0,t.jsxs)(n.ol,{children:["\n",(0,t.jsxs)(n.li,{children:["\n",(0,t.jsxs)(n.p,{children:[(0,t.jsx)(n.strong,{children:"\u521b\u5efa\u6570\u636e\u76ee\u5f55"}),"\uff1a"]}),"\n",(0,t.jsx)(n.pre,{children:(0,t.jsx)(n.code,{className:"language-bash",children:"mkdir -p etcd-cluster/{infra0,infra1,infra2}\n"})}),"\n"]}),"\n",(0,t.jsxs)(n.li,{children:["\n",(0,t.jsxs)(n.p,{children:[(0,t.jsx)(n.strong,{children:"\u8fd0\u884c\u8282\u70b9"}),"\uff1a"]}),"\n",(0,t.jsxs)(n.ul,{children:["\n",(0,t.jsx)(n.li,{children:"\u6253\u5f00\u4e09\u4e2a\u7ec8\u7aef\u7a97\u53e3\u3002"}),"\n",(0,t.jsx)(n.li,{children:"\u5728\u6bcf\u4e2a\u7ec8\u7aef\u5206\u522b\u7c98\u8d34\u5e76\u8fd0\u884c\u4e0a\u8ff0\u547d\u4ee4\u3002"}),"\n",(0,t.jsx)(n.li,{children:"\u6bcf\u4e2a\u547d\u4ee4\u4f1a\u5728\u524d\u53f0\u8fd0\u884c\uff0c\u8f93\u51fa\u65e5\u5fd7\u5230\u7ec8\u7aef\u3002"}),"\n"]}),"\n"]}),"\n",(0,t.jsxs)(n.li,{children:["\n",(0,t.jsxs)(n.p,{children:[(0,t.jsx)(n.strong,{children:"\u9a8c\u8bc1\u96c6\u7fa4"}),"\uff1a"]}),"\n",(0,t.jsxs)(n.ul,{children:["\n",(0,t.jsxs)(n.li,{children:["\n",(0,t.jsx)(n.p,{children:"\u5728\u7b2c\u56db\u4e2a\u7ec8\u7aef\u68c0\u67e5\u5065\u5eb7\u72b6\u6001\uff1a"}),"\n",(0,t.jsx)(n.pre,{children:(0,t.jsx)(n.code,{className:"language-bash",children:"ETCDCTL_API=3 etcdctl --endpoints=http://127.0.0.1:2379,http://127.0.0.1:2479,http://127.0.0.1:2579 endpoint health\n"})}),"\n"]}),"\n"]}),"\n"]}),"\n"]}),"\n",(0,t.jsx)(n.hr,{}),"\n",(0,t.jsx)(n.h3,{id:"\u6ce8\u610f\u4e8b\u9879",children:"\u6ce8\u610f\u4e8b\u9879"}),"\n",(0,t.jsxs)(n.ul,{children:["\n",(0,t.jsxs)(n.li,{children:[(0,t.jsx)(n.strong,{children:"\u524d\u53f0\u8fd0\u884c"}),"\uff1a","\n",(0,t.jsxs)(n.ul,{children:["\n",(0,t.jsxs)(n.li,{children:["\u4e0d\u52a0 ",(0,t.jsx)(n.code,{children:"> logfile 2>&1 &"}),"\uff0c\u65e5\u5fd7\u76f4\u63a5\u8f93\u51fa\u5230\u7ec8\u7aef\uff0c\u6309 ",(0,t.jsx)(n.code,{children:"Ctrl+C"})," \u505c\u6b62\u8282\u70b9\u3002"]}),"\n"]}),"\n"]}),"\n",(0,t.jsxs)(n.li,{children:[(0,t.jsx)(n.strong,{children:"\u5355\u884c\u7c98\u8d34"}),"\uff1a","\n",(0,t.jsxs)(n.ul,{children:["\n",(0,t.jsx)(n.li,{children:"\u6bcf\u4e2a\u547d\u4ee4\u5df2\u538b\u7f29\u4e3a\u4e00\u884c\uff0c\u65b9\u4fbf\u590d\u5236\u3002"}),"\n"]}),"\n"]}),"\n",(0,t.jsxs)(n.li,{children:[(0,t.jsx)(n.strong,{children:"\u987a\u5e8f\u542f\u52a8"}),"\uff1a","\n",(0,t.jsxs)(n.ul,{children:["\n",(0,t.jsxs)(n.li,{children:["\u5efa\u8bae\u5148\u542f\u52a8 ",(0,t.jsx)(n.code,{children:"infra0"}),"\uff0c\u518d\u542f\u52a8\u5176\u4ed6\u8282\u70b9\uff0c\u786e\u4fdd\u96c6\u7fa4\u521d\u59cb\u5316\u6b63\u5e38\u3002"]}),"\n"]}),"\n"]}),"\n"]}),"\n",(0,t.jsx)(n.hr,{}),"\n",(0,t.jsx)(n.h3,{id:"\u5982\u679c\u9700\u8981\u5355\u7ec8\u7aef\u8fd0\u884c",children:"\u5982\u679c\u9700\u8981\u5355\u7ec8\u7aef\u8fd0\u884c"}),"\n",(0,t.jsxs)(n.p,{children:["\u7531\u4e8e\u524d\u53f0\u8fd0\u884c\u65e0\u6cd5\u5728\u540c\u4e00\u7ec8\u7aef\u542f\u52a8\u591a\u4e2a\u8282\u70b9\uff0c\u4f60\u53ef\u4ee5\u7528 ",(0,t.jsx)(n.code,{children:"tmux"})," \u6216 ",(0,t.jsx)(n.code,{children:"screen"})," \u5206\u5c4f\uff1a"]}),"\n",(0,t.jsxs)(n.ol,{children:["\n",(0,t.jsxs)(n.li,{children:["\n",(0,t.jsxs)(n.p,{children:["\u5b89\u88c5 ",(0,t.jsx)(n.code,{children:"tmux"}),"\uff1a"]}),"\n",(0,t.jsx)(n.pre,{children:(0,t.jsx)(n.code,{className:"language-bash",children:"sudo apt install tmux\n"})}),"\n"]}),"\n",(0,t.jsxs)(n.li,{children:["\n",(0,t.jsxs)(n.p,{children:["\u542f\u52a8 ",(0,t.jsx)(n.code,{children:"tmux"}),"\uff1a"]}),"\n",(0,t.jsx)(n.pre,{children:(0,t.jsx)(n.code,{className:"language-bash",children:"tmux\n"})}),"\n"]}),"\n",(0,t.jsxs)(n.li,{children:["\n",(0,t.jsx)(n.p,{children:"\u5206\u5272\u7a97\u53e3\uff08\u6bcf\u4e2a\u7a97\u53e3\u8fd0\u884c\u4e00\u4e2a\u8282\u70b9\uff09\uff1a"}),"\n",(0,t.jsxs)(n.ul,{children:["\n",(0,t.jsxs)(n.li,{children:[(0,t.jsx)(n.code,{children:"Ctrl+B"})," \u7136\u540e ",(0,t.jsx)(n.code,{children:'"'}),"\uff08\u5782\u76f4\u5206\u5272\uff09\u3002"]}),"\n",(0,t.jsx)(n.li,{children:"\u5728\u6bcf\u4e2a pane \u7c98\u8d34\u4e00\u4e2a\u547d\u4ee4\u3002"}),"\n"]}),"\n"]}),"\n"]}),"\n",(0,t.jsx)(n.p,{children:"\u6216\u8005\u7528\u811a\u672c\u5faa\u73af\uff0c\u4f46\u4ecd\u9700\u624b\u52a8\u5f00\u591a\u4e2a\u7ec8\u7aef\u6267\u884c\uff1a"}),"\n",(0,t.jsx)(n.pre,{children:(0,t.jsx)(n.code,{className:"language-bash",children:'#!/bin/bash\nfor i in 0 1 2; do\n  echo "Run in new terminal: etcd --name infra$i --data-dir etcd-cluster/infra$i --listen-client-urls http://127.0.0.1:2${i}79 --advertise-client-urls http://127.0.0.1:2${i}79 --listen-peer-urls http://127.0.0.1:238$i --initial-advertise-peer-urls http://127.0.0.1:238$i --initial-cluster infra0=http://127.0.0.1:2380,infra1=http://127.0.0.1:2381,infra2=http://127.0.0.1:2382 --initial-cluster-token etcd-cluster-1 --initial-cluster-state new --log-level info --logger zap"\ndone\n'})}),"\n",(0,t.jsx)(n.hr,{}),"\n",(0,t.jsx)(n.h3,{id:"\u9a8c\u8bc1",children:"\u9a8c\u8bc1"}),"\n",(0,t.jsx)(n.p,{children:"\u542f\u52a8\u540e\u8fd0\u884c\uff1a"}),"\n",(0,t.jsx)(n.pre,{children:(0,t.jsx)(n.code,{className:"language-bash",children:"curl http://127.0.0.1:2379/health\n"})}),"\n",(0,t.jsxs)(n.ul,{children:["\n",(0,t.jsxs)(n.li,{children:["\u5e94\u8fd4\u56de ",(0,t.jsx)(n.code,{children:'{"health":"true"}'}),"\u3002"]}),"\n"]})]})}function o(e={}){const{wrapper:n}={...(0,s.R)(),...e.components};return n?(0,t.jsx)(n,{...e,children:(0,t.jsx)(h,{...e})}):h(e)}}}]);