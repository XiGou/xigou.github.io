"use strict";(self.webpackChunkpersonal_blog=self.webpackChunkpersonal_blog||[]).push([[8938],{11400:(e,t,r)=>{r.d(t,{m:()=>s});var i=r(63300),s=class{constructor(e){this.init=e,this.records=this.init()}static{(0,i.K2)(this,"ImperativeState")}reset(){this.records=this.init()}}},57354:(e,t,r)=>{function i(e,t){e.accDescr&&t.setAccDescription?.(e.accDescr),e.accTitle&&t.setAccTitle?.(e.accTitle),e.title&&t.setDiagramTitle?.(e.title)}r.d(t,{S:()=>i}),(0,r(63300).K2)(i,"populateCommonDb")},88938:(e,t,r)=>{r.d(t,{diagram:()=>he});var i=r(52454),s=r(25664),o=r(57354),n=r(11400),c=(r(55395),r(79008)),a=r(63300),d=r(78731),l=r(90165),f=r(26527),h=r(35855),g={L:"left",R:"right",T:"top",B:"bottom"},p={L:(0,a.K2)((e=>`${e},${e/2} 0,${e} 0,0`),"L"),R:(0,a.K2)((e=>`0,${e/2} ${e},0 ${e},${e}`),"R"),T:(0,a.K2)((e=>`0,0 ${e},0 ${e/2},${e}`),"T"),B:(0,a.K2)((e=>`${e/2},0 ${e},${e} 0,${e}`),"B")},u={L:(0,a.K2)(((e,t)=>e-t+2),"L"),R:(0,a.K2)(((e,t)=>e-2),"R"),T:(0,a.K2)(((e,t)=>e-t+2),"T"),B:(0,a.K2)(((e,t)=>e-2),"B")},m=(0,a.K2)((function(e){return w(e)?"L"===e?"R":"L":"T"===e?"B":"T"}),"getOppositeArchitectureDirection"),y=(0,a.K2)((function(e){return"L"===e||"R"===e||"T"===e||"B"===e}),"isArchitectureDirection"),w=(0,a.K2)((function(e){return"L"===e||"R"===e}),"isArchitectureDirectionX"),k=(0,a.K2)((function(e){return"T"===e||"B"===e}),"isArchitectureDirectionY"),x=(0,a.K2)((function(e,t){const r=w(e)&&k(t),i=k(e)&&w(t);return r||i}),"isArchitectureDirectionXY"),b=(0,a.K2)((function(e){const t=e[0],r=e[1],i=w(t)&&k(r),s=k(t)&&w(r);return i||s}),"isArchitecturePairXY"),v=(0,a.K2)((function(e){return"LL"!==e&&"RR"!==e&&"TT"!==e&&"BB"!==e}),"isValidArchitectureDirectionPair"),$=(0,a.K2)((function(e,t){const r=`${e}${t}`;return v(r)?r:void 0}),"getArchitectureDirectionPair"),K=(0,a.K2)((function([e,t],r){const i=r[0],s=r[1];return w(i)?k(s)?[e+("L"===i?-1:1),t+("T"===s?1:-1)]:[e+("L"===i?-1:1),t]:w(s)?[e+("L"===s?1:-1),t+("T"===i?1:-1)]:[e,t+("T"===i?1:-1)]}),"shiftPositionByArchitectureDirectionPair"),E=(0,a.K2)((function(e){return"LT"===e||"TL"===e?[1,1]:"BL"===e||"LB"===e?[1,-1]:"BR"===e||"RB"===e?[-1,-1]:[-1,1]}),"getArchitectureDirectionXYFactors"),D=(0,a.K2)((function(e,t){return x(e,t)?"bend":w(e)?"horizontal":"vertical"}),"getArchitectureDirectionAlignment"),T=(0,a.K2)((function(e){return"service"===e.type}),"isArchitectureService"),I=(0,a.K2)((function(e){return"junction"===e.type}),"isArchitectureJunction"),S=(0,a.K2)((e=>e.data()),"edgeData"),L=(0,a.K2)((e=>e.data()),"nodeData"),B=a.UI.architecture,A=new n.m((()=>({nodes:{},groups:{},edges:[],registeredIds:{},config:B,dataStructures:void 0,elements:{}}))),j=(0,a.K2)((()=>{A.reset(),(0,a.IU)()}),"clear"),G=(0,a.K2)((function({id:e,icon:t,in:r,title:i,iconText:s}){if(void 0!==A.records.registeredIds[e])throw new Error(`The service id [${e}] is already in use by another ${A.records.registeredIds[e]}`);if(void 0!==r){if(e===r)throw new Error(`The service [${e}] cannot be placed within itself`);if(void 0===A.records.registeredIds[r])throw new Error(`The service [${e}]'s parent does not exist. Please make sure the parent is created before this service`);if("node"===A.records.registeredIds[r])throw new Error(`The service [${e}]'s parent is not a group`)}A.records.registeredIds[e]="node",A.records.nodes[e]={id:e,type:"service",icon:t,iconText:s,title:i,edges:[],in:r}}),"addService"),R=(0,a.K2)((()=>Object.values(A.records.nodes).filter(T)),"getServices"),z=(0,a.K2)((function({id:e,in:t}){A.records.registeredIds[e]="node",A.records.nodes[e]={id:e,type:"junction",edges:[],in:t}}),"addJunction"),O=(0,a.K2)((()=>Object.values(A.records.nodes).filter(I)),"getJunctions"),M=(0,a.K2)((()=>Object.values(A.records.nodes)),"getNodes"),P=(0,a.K2)((e=>A.records.nodes[e]),"getNode"),C=(0,a.K2)((function({id:e,icon:t,in:r,title:i}){if(void 0!==A.records.registeredIds[e])throw new Error(`The group id [${e}] is already in use by another ${A.records.registeredIds[e]}`);if(void 0!==r){if(e===r)throw new Error(`The group [${e}] cannot be placed within itself`);if(void 0===A.records.registeredIds[r])throw new Error(`The group [${e}]'s parent does not exist. Please make sure the parent is created before this group`);if("node"===A.records.registeredIds[r])throw new Error(`The group [${e}]'s parent is not a group`)}A.records.registeredIds[e]="group",A.records.groups[e]={id:e,icon:t,title:i,in:r}}),"addGroup"),Y=(0,a.K2)((()=>Object.values(A.records.groups)),"getGroups"),Z=(0,a.K2)((function({lhsId:e,rhsId:t,lhsDir:r,rhsDir:i,lhsInto:s,rhsInto:o,lhsGroup:n,rhsGroup:c,title:a}){if(!y(r))throw new Error(`Invalid direction given for left hand side of edge ${e}--${t}. Expected (L,R,T,B) got ${r}`);if(!y(i))throw new Error(`Invalid direction given for right hand side of edge ${e}--${t}. Expected (L,R,T,B) got ${i}`);if(void 0===A.records.nodes[e]&&void 0===A.records.groups[e])throw new Error(`The left-hand id [${e}] does not yet exist. Please create the service/group before declaring an edge to it.`);if(void 0===A.records.nodes[t]&&void 0===A.records.groups[e])throw new Error(`The right-hand id [${t}] does not yet exist. Please create the service/group before declaring an edge to it.`);const d=A.records.nodes[e].in,l=A.records.nodes[t].in;if(n&&d&&l&&d==l)throw new Error(`The left-hand id [${e}] is modified to traverse the group boundary, but the edge does not pass through two groups.`);if(c&&d&&l&&d==l)throw new Error(`The right-hand id [${t}] is modified to traverse the group boundary, but the edge does not pass through two groups.`);const f={lhsId:e,lhsDir:r,lhsInto:s,lhsGroup:n,rhsId:t,rhsDir:i,rhsInto:o,rhsGroup:c,title:a};A.records.edges.push(f),A.records.nodes[e]&&A.records.nodes[t]&&(A.records.nodes[e].edges.push(A.records.edges[A.records.edges.length-1]),A.records.nodes[t].edges.push(A.records.edges[A.records.edges.length-1]))}),"addEdge"),N=(0,a.K2)((()=>A.records.edges),"getEdges"),J=(0,a.K2)((()=>{if(void 0===A.records.dataStructures){const e={},t=Object.entries(A.records.nodes).reduce(((t,[r,i])=>(t[r]=i.edges.reduce(((t,i)=>{const s=P(i.lhsId)?.in,o=P(i.rhsId)?.in;if(s&&o&&s!==o){const t=D(i.lhsDir,i.rhsDir);"bend"!==t&&(e[s]??={},e[s][o]=t,e[o]??={},e[o][s]=t)}if(i.lhsId===r){const e=$(i.lhsDir,i.rhsDir);e&&(t[e]=i.rhsId)}else{const e=$(i.rhsDir,i.lhsDir);e&&(t[e]=i.lhsId)}return t}),{}),t)),{}),r=Object.keys(t)[0],i={[r]:1},s=Object.keys(t).reduce(((e,t)=>t===r?e:{...e,[t]:1}),{}),o=(0,a.K2)((e=>{const r={[e]:[0,0]},o=[e];for(;o.length>0;){const e=o.shift();if(e){i[e]=1,delete s[e];const n=t[e],[c,a]=r[e];Object.entries(n).forEach((([e,t])=>{i[t]||(r[t]=K([c,a],e),o.push(t))}))}}return r}),"BFS"),n=[o(r)];for(;Object.keys(s).length>0;)n.push(o(Object.keys(s)[0]));A.records.dataStructures={adjList:t,spatialMaps:n,groupAlignments:e}}return A.records.dataStructures}),"getDataStructures"),X=(0,a.K2)(((e,t)=>{A.records.elements[e]=t}),"setElementForId"),q=(0,a.K2)((e=>A.records.elements[e]),"getElementById"),F={clear:j,setDiagramTitle:a.ke,getDiagramTitle:a.ab,setAccTitle:a.SV,getAccTitle:a.iN,setAccDescription:a.EI,getAccDescription:a.m7,addService:G,getServices:R,addJunction:z,getJunctions:O,getNodes:M,getNode:P,addGroup:C,getGroups:Y,addEdge:Z,getEdges:N,setElementForId:X,getElementById:q,getDataStructures:J};function W(e){const t=(0,a.D7)().architecture;return t?.[e]?t[e]:B[e]}(0,a.K2)(W,"getConfigField");var H=(0,a.K2)(((e,t)=>{(0,o.S)(e,t),e.groups.map(t.addGroup),e.services.map((e=>t.addService({...e,type:"service"}))),e.junctions.map((e=>t.addJunction({...e,type:"junction"}))),e.edges.map(t.addEdge)}),"populateDb"),_={parse:(0,a.K2)((async e=>{const t=await(0,d.qg)("architecture",e);a.Rm.debug(t),H(t,F)}),"parse")},V=(0,a.K2)((e=>`\n  .edge {\n    stroke-width: ${e.archEdgeWidth};\n    stroke: ${e.archEdgeColor};\n    fill: none;\n  }\n\n  .arrow {\n    fill: ${e.archEdgeArrowColor};\n  }\n\n  .node-bkg {\n    fill: none;\n    stroke: ${e.archGroupBorderColor};\n    stroke-width: ${e.archGroupBorderWidth};\n    stroke-dasharray: 8;\n  }\n  .node-icon-text {\n    display: flex; \n    align-items: center;\n  }\n  \n  .node-icon-text > div {\n    color: #fff;\n    margin: 1px;\n    height: fit-content;\n    text-align: center;\n    overflow: hidden;\n    display: -webkit-box;\n    -webkit-box-orient: vertical;\n  }\n`),"getStyles"),U=(0,a.K2)((e=>`<g><rect width="80" height="80" style="fill: #087ebf; stroke-width: 0px;"/>${e}</g>`),"wrapIcon"),Q={prefix:"mermaid-architecture",height:80,width:80,icons:{database:{body:U('<path id="b" data-name="4" d="m20,57.86c0,3.94,8.95,7.14,20,7.14s20-3.2,20-7.14" style="fill: none; stroke: #fff; stroke-miterlimit: 10; stroke-width: 2px;"/><path id="c" data-name="3" d="m20,45.95c0,3.94,8.95,7.14,20,7.14s20-3.2,20-7.14" style="fill: none; stroke: #fff; stroke-miterlimit: 10; stroke-width: 2px;"/><path id="d" data-name="2" d="m20,34.05c0,3.94,8.95,7.14,20,7.14s20-3.2,20-7.14" style="fill: none; stroke: #fff; stroke-miterlimit: 10; stroke-width: 2px;"/><ellipse id="e" data-name="1" cx="40" cy="22.14" rx="20" ry="7.14" style="fill: none; stroke: #fff; stroke-miterlimit: 10; stroke-width: 2px;"/><line x1="20" y1="57.86" x2="20" y2="22.14" style="fill: none; stroke: #fff; stroke-miterlimit: 10; stroke-width: 2px;"/><line x1="60" y1="57.86" x2="60" y2="22.14" style="fill: none; stroke: #fff; stroke-miterlimit: 10; stroke-width: 2px;"/>')},server:{body:U('<rect x="17.5" y="17.5" width="45" height="45" rx="2" ry="2" style="fill: none; stroke: #fff; stroke-miterlimit: 10; stroke-width: 2px;"/><line x1="17.5" y1="32.5" x2="62.5" y2="32.5" style="fill: none; stroke: #fff; stroke-miterlimit: 10; stroke-width: 2px;"/><line x1="17.5" y1="47.5" x2="62.5" y2="47.5" style="fill: none; stroke: #fff; stroke-miterlimit: 10; stroke-width: 2px;"/><g><path d="m56.25,25c0,.27-.45.5-1,.5h-10.5c-.55,0-1-.23-1-.5s.45-.5,1-.5h10.5c.55,0,1,.23,1,.5Z" style="fill: #fff; stroke-width: 0px;"/><path d="m56.25,25c0,.27-.45.5-1,.5h-10.5c-.55,0-1-.23-1-.5s.45-.5,1-.5h10.5c.55,0,1,.23,1,.5Z" style="fill: none; stroke: #fff; stroke-miterlimit: 10;"/></g><g><path d="m56.25,40c0,.27-.45.5-1,.5h-10.5c-.55,0-1-.23-1-.5s.45-.5,1-.5h10.5c.55,0,1,.23,1,.5Z" style="fill: #fff; stroke-width: 0px;"/><path d="m56.25,40c0,.27-.45.5-1,.5h-10.5c-.55,0-1-.23-1-.5s.45-.5,1-.5h10.5c.55,0,1,.23,1,.5Z" style="fill: none; stroke: #fff; stroke-miterlimit: 10;"/></g><g><path d="m56.25,55c0,.27-.45.5-1,.5h-10.5c-.55,0-1-.23-1-.5s.45-.5,1-.5h10.5c.55,0,1,.23,1,.5Z" style="fill: #fff; stroke-width: 0px;"/><path d="m56.25,55c0,.27-.45.5-1,.5h-10.5c-.55,0-1-.23-1-.5s.45-.5,1-.5h10.5c.55,0,1,.23,1,.5Z" style="fill: none; stroke: #fff; stroke-miterlimit: 10;"/></g><g><circle cx="32.5" cy="25" r=".75" style="fill: #fff; stroke: #fff; stroke-miterlimit: 10;"/><circle cx="27.5" cy="25" r=".75" style="fill: #fff; stroke: #fff; stroke-miterlimit: 10;"/><circle cx="22.5" cy="25" r=".75" style="fill: #fff; stroke: #fff; stroke-miterlimit: 10;"/></g><g><circle cx="32.5" cy="40" r=".75" style="fill: #fff; stroke: #fff; stroke-miterlimit: 10;"/><circle cx="27.5" cy="40" r=".75" style="fill: #fff; stroke: #fff; stroke-miterlimit: 10;"/><circle cx="22.5" cy="40" r=".75" style="fill: #fff; stroke: #fff; stroke-miterlimit: 10;"/></g><g><circle cx="32.5" cy="55" r=".75" style="fill: #fff; stroke: #fff; stroke-miterlimit: 10;"/><circle cx="27.5" cy="55" r=".75" style="fill: #fff; stroke: #fff; stroke-miterlimit: 10;"/><circle cx="22.5" cy="55" r=".75" style="fill: #fff; stroke: #fff; stroke-miterlimit: 10;"/></g>')},disk:{body:U('<rect x="20" y="15" width="40" height="50" rx="1" ry="1" style="fill: none; stroke: #fff; stroke-miterlimit: 10; stroke-width: 2px;"/><ellipse cx="24" cy="19.17" rx=".8" ry=".83" style="fill: none; stroke: #fff; stroke-miterlimit: 10; stroke-width: 2px;"/><ellipse cx="56" cy="19.17" rx=".8" ry=".83" style="fill: none; stroke: #fff; stroke-miterlimit: 10; stroke-width: 2px;"/><ellipse cx="24" cy="60.83" rx=".8" ry=".83" style="fill: none; stroke: #fff; stroke-miterlimit: 10; stroke-width: 2px;"/><ellipse cx="56" cy="60.83" rx=".8" ry=".83" style="fill: none; stroke: #fff; stroke-miterlimit: 10; stroke-width: 2px;"/><ellipse cx="40" cy="33.75" rx="14" ry="14.58" style="fill: none; stroke: #fff; stroke-miterlimit: 10; stroke-width: 2px;"/><ellipse cx="40" cy="33.75" rx="4" ry="4.17" style="fill: #fff; stroke: #fff; stroke-miterlimit: 10; stroke-width: 2px;"/><path d="m37.51,42.52l-4.83,13.22c-.26.71-1.1,1.02-1.76.64l-4.18-2.42c-.66-.38-.81-1.26-.33-1.84l9.01-10.8c.88-1.05,2.56-.08,2.09,1.2Z" style="fill: #fff; stroke-width: 0px;"/>')},internet:{body:U('<circle cx="40" cy="40" r="22.5" style="fill: none; stroke: #fff; stroke-miterlimit: 10; stroke-width: 2px;"/><line x1="40" y1="17.5" x2="40" y2="62.5" style="fill: none; stroke: #fff; stroke-miterlimit: 10; stroke-width: 2px;"/><line x1="17.5" y1="40" x2="62.5" y2="40" style="fill: none; stroke: #fff; stroke-miterlimit: 10; stroke-width: 2px;"/><path d="m39.99,17.51c-15.28,11.1-15.28,33.88,0,44.98" style="fill: none; stroke: #fff; stroke-miterlimit: 10; stroke-width: 2px;"/><path d="m40.01,17.51c15.28,11.1,15.28,33.88,0,44.98" style="fill: none; stroke: #fff; stroke-miterlimit: 10; stroke-width: 2px;"/><line x1="19.75" y1="30.1" x2="60.25" y2="30.1" style="fill: none; stroke: #fff; stroke-miterlimit: 10; stroke-width: 2px;"/><line x1="19.75" y1="49.9" x2="60.25" y2="49.9" style="fill: none; stroke: #fff; stroke-miterlimit: 10; stroke-width: 2px;"/>')},cloud:{body:U('<path d="m65,47.5c0,2.76-2.24,5-5,5H20c-2.76,0-5-2.24-5-5,0-1.87,1.03-3.51,2.56-4.36-.04-.21-.06-.42-.06-.64,0-2.6,2.48-4.74,5.65-4.97,1.65-4.51,6.34-7.76,11.85-7.76.86,0,1.69.08,2.5.23,2.09-1.57,4.69-2.5,7.5-2.5,6.1,0,11.19,4.38,12.28,10.17,2.14.56,3.72,2.51,3.72,4.83,0,.03,0,.07-.01.1,2.29.46,4.01,2.48,4.01,4.9Z" style="fill: none; stroke: #fff; stroke-miterlimit: 10; stroke-width: 2px;"/>')},unknown:i.Gc,blank:{body:U("")}}},ee=(0,a.K2)((async function(e,t){const r=W("padding"),i=W("iconSize"),o=i/2,n=i/6,c=n/2;await Promise.all(t.edges().map((async t=>{const{source:i,sourceDir:d,sourceArrow:l,sourceGroup:f,target:h,targetDir:g,targetArrow:m,targetGroup:y,label:v}=S(t);let{x:K,y:D}=t[0].sourceEndpoint();const{x:T,y:I}=t[0].midpoint();let{x:L,y:B}=t[0].targetEndpoint();const A=r+4;if(f&&(w(d)?K+="L"===d?-A:A:D+="T"===d?-A:A+18),y&&(w(g)?L+="L"===g?-A:A:B+="T"===g?-A:A+18),f||"junction"!==F.getNode(i)?.type||(w(d)?K+="L"===d?o:-o:D+="T"===d?o:-o),y||"junction"!==F.getNode(h)?.type||(w(g)?L+="L"===g?o:-o:B+="T"===g?o:-o),t[0]._private.rscratch){const t=e.insert("g");if(t.insert("path").attr("d",`M ${K},${D} L ${T},${I} L${L},${B} `).attr("class","edge"),l){const e=w(d)?u[d](K,n):K-c,r=k(d)?u[d](D,n):D-c;t.insert("polygon").attr("points",p[d](n)).attr("transform",`translate(${e},${r})`).attr("class","arrow")}if(m){const e=w(g)?u[g](L,n):L-c,r=k(g)?u[g](B,n):B-c;t.insert("polygon").attr("points",p[g](n)).attr("transform",`translate(${e},${r})`).attr("class","arrow")}if(v){const e=x(d,g)?"XY":w(d)?"X":"Y";let r=0;r="X"===e?Math.abs(K-L):"Y"===e?Math.abs(D-B)/1.5:Math.abs(K-L)/2;const i=t.append("g");if(await(0,s.GZ)(i,v,{useHtmlLabels:!1,width:r,classes:"architecture-service-label"},(0,a.D7)()),i.attr("dy","1em").attr("alignment-baseline","middle").attr("dominant-baseline","middle").attr("text-anchor","middle"),"X"===e)i.attr("transform","translate("+T+", "+I+")");else if("Y"===e)i.attr("transform","translate("+T+", "+I+") rotate(-90)");else if("XY"===e){const e=$(d,g);if(e&&b(e)){const t=i.node().getBoundingClientRect(),[r,s]=E(e);i.attr("dominant-baseline","auto").attr("transform",`rotate(${-1*r*s*45})`);const o=i.node().getBoundingClientRect();i.attr("transform",`\n                translate(${T}, ${I-t.height/2})\n                translate(${r*o.width/2}, ${s*o.height/2})\n                rotate(${-1*r*s*45}, 0, ${t.height/2})\n              `)}}}}})))}),"drawEdges"),te=(0,a.K2)((async function(e,t){const r=.75*W("padding"),o=W("fontSize"),n=W("iconSize")/2;await Promise.all(t.nodes().map((async t=>{const c=L(t);if("group"===c.type){const{h:d,w:l,x1:f,y1:h}=t.boundingBox();e.append("rect").attr("x",f+n).attr("y",h+n).attr("width",l).attr("height",d).attr("class","node-bkg");const g=e.append("g");let p=f,u=h;if(c.icon){const e=g.append("g");e.html(`<g>${await(0,i.WY)(c.icon,{height:r,width:r,fallbackPrefix:Q.prefix})}</g>`),e.attr("transform","translate("+(p+n+1)+", "+(u+n+1)+")"),p+=r,u+=o/2-1-2}if(c.label){const e=g.append("g");await(0,s.GZ)(e,c.label,{useHtmlLabels:!1,width:l,classes:"architecture-service-label"},(0,a.D7)()),e.attr("dy","1em").attr("alignment-baseline","middle").attr("dominant-baseline","start").attr("text-anchor","start"),e.attr("transform","translate("+(p+n+4)+", "+(u+n+2)+")")}}})))}),"drawGroups"),re=(0,a.K2)((async function(e,t,r){for(const o of r){const r=t.append("g"),n=W("iconSize");if(o.title){const e=r.append("g");await(0,s.GZ)(e,o.title,{useHtmlLabels:!1,width:1.5*n,classes:"architecture-service-label"},(0,a.D7)()),e.attr("dy","1em").attr("alignment-baseline","middle").attr("dominant-baseline","middle").attr("text-anchor","middle"),e.attr("transform","translate("+n/2+", "+n+")")}const c=r.append("g");if(o.icon)c.html(`<g>${await(0,i.WY)(o.icon,{height:n,width:n,fallbackPrefix:Q.prefix})}</g>`);else if(o.iconText){c.html(`<g>${await(0,i.WY)("blank",{height:n,width:n,fallbackPrefix:Q.prefix})}</g>`);const e=c.append("g").append("foreignObject").attr("width",n).attr("height",n).append("div").attr("class","node-icon-text").attr("style",`height: ${n}px;`).append("div").html(o.iconText),t=parseInt(window.getComputedStyle(e.node(),null).getPropertyValue("font-size").replace(/\D/g,""))??16;e.attr("style",`-webkit-line-clamp: ${Math.floor((n-2)/t)};`)}else c.append("path").attr("class","node-bkg").attr("id","node-"+o.id).attr("d",`M0 ${n} v${-n} q0,-5 5,-5 h${n} q5,0 5,5 v${n} H0 Z`);r.attr("class","architecture-service");const{width:d,height:l}=r._groups[0][0].getBBox();o.width=d,o.height=l,e.setElementForId(o.id,r)}return 0}),"drawServices"),ie=(0,a.K2)((function(e,t,r){r.forEach((r=>{const i=t.append("g"),s=W("iconSize");i.append("g").append("rect").attr("id","node-"+r.id).attr("fill-opacity","0").attr("width",s).attr("height",s),i.attr("class","architecture-junction");const{width:o,height:n}=i._groups[0][0].getBBox();i.width=o,i.height=n,e.setElementForId(r.id,i)}))}),"drawJunctions");function se(e,t){e.forEach((e=>{t.add({group:"nodes",data:{type:"service",id:e.id,icon:e.icon,label:e.title,parent:e.in,width:W("iconSize"),height:W("iconSize")},classes:"node-service"})}))}function oe(e,t){e.forEach((e=>{t.add({group:"nodes",data:{type:"junction",id:e.id,parent:e.in,width:W("iconSize"),height:W("iconSize")},classes:"node-junction"})}))}function ne(e,t){t.nodes().map((t=>{const r=L(t);if("group"===r.type)return;r.x=t.position().x,r.y=t.position().y;e.getElementById(r.id).attr("transform","translate("+(r.x||0)+","+(r.y||0)+")")}))}function ce(e,t){e.forEach((e=>{t.add({group:"nodes",data:{type:"group",id:e.id,icon:e.icon,label:e.title,parent:e.in},classes:"node-group"})}))}function ae(e,t){e.forEach((e=>{const{lhsId:r,rhsId:i,lhsInto:s,lhsGroup:o,rhsInto:n,lhsDir:c,rhsDir:a,rhsGroup:d,title:l}=e,f=x(e.lhsDir,e.rhsDir)?"segments":"straight",h={id:`${r}-${i}`,label:l,source:r,sourceDir:c,sourceArrow:s,sourceGroup:o,sourceEndpoint:"L"===c?"0 50%":"R"===c?"100% 50%":"T"===c?"50% 0":"50% 100%",target:i,targetDir:a,targetArrow:n,targetGroup:d,targetEndpoint:"L"===a?"0 50%":"R"===a?"100% 50%":"T"===a?"50% 0":"50% 100%"};t.add({group:"edges",data:h,classes:f})}))}function de(e,t,r){const i=(0,a.K2)(((e,t)=>Object.entries(e).reduce(((e,[i,s])=>{let o=0;const n=Object.entries(s);if(1===n.length)return e[i]=n[0][1],e;for(let c=0;c<n.length-1;c++)for(let s=c+1;s<n.length;s++){const[a,d]=n[c],[l,f]=n[s],h=r[a]?.[l];if(h===t)e[i]??=[],e[i]=[...e[i],...d,...f];else if("default"===a||"default"===l)e[i]??=[],e[i]=[...e[i],...d,...f];else{e[`${i}-${o++}`]=d;e[`${i}-${o++}`]=f}}return e}),{})),"flattenAlignments"),s=t.map((t=>{const r={},s={};return Object.entries(t).forEach((([t,[i,o]])=>{const n=e.getNode(t)?.in??"default";r[o]??={},r[o][n]??=[],r[o][n].push(t),s[i]??={},s[i][n]??=[],s[i][n].push(t)})),{horiz:Object.values(i(r,"horizontal")).filter((e=>e.length>1)),vert:Object.values(i(s,"vertical")).filter((e=>e.length>1))}})),[o,n]=s.reduce((([e,t],{horiz:r,vert:i})=>[[...e,...r],[...t,...i]]),[[],[]]);return{horizontal:o,vertical:n}}function le(e){const t=[],r=(0,a.K2)((e=>`${e[0]},${e[1]}`),"posToStr"),i=(0,a.K2)((e=>e.split(",").map((e=>parseInt(e)))),"strToPos");return e.forEach((e=>{const s=Object.fromEntries(Object.entries(e).map((([e,t])=>[r(t),e]))),o=[r([0,0])],n={},c={L:[-1,0],R:[1,0],T:[0,1],B:[0,-1]};for(;o.length>0;){const e=o.shift();if(e){n[e]=1;const a=s[e];if(a){const d=i(e);Object.entries(c).forEach((([e,i])=>{const c=r([d[0]+i[0],d[1]+i[1]]),l=s[c];l&&!n[c]&&(o.push(c),t.push({[g[e]]:l,[g[m(e)]]:a,gap:1.5*W("iconSize")}))}))}}}})),t}function fe(e,t,r,i,s,{spatialMaps:o,groupAlignments:n}){return new Promise((c=>{const d=(0,h.Ltv)("body").append("div").attr("id","cy").attr("style","display:none"),f=(0,l.A)({container:document.getElementById("cy"),style:[{selector:"edge",style:{"curve-style":"straight",label:"data(label)","source-endpoint":"data(sourceEndpoint)","target-endpoint":"data(targetEndpoint)"}},{selector:"edge.segments",style:{"curve-style":"segments","segment-weights":"0","segment-distances":[.5],"edge-distances":"endpoints","source-endpoint":"data(sourceEndpoint)","target-endpoint":"data(targetEndpoint)"}},{selector:"node",style:{"compound-sizing-wrt-labels":"include"}},{selector:"node[label]",style:{"text-valign":"bottom","text-halign":"center","font-size":`${W("fontSize")}px`}},{selector:".node-service",style:{label:"data(label)",width:"data(width)",height:"data(height)"}},{selector:".node-junction",style:{width:"data(width)",height:"data(height)"}},{selector:".node-group",style:{padding:`${W("padding")}px`}}]});d.remove(),ce(r,f),se(e,f),oe(t,f),ae(i,f);const g=de(s,o,n),p=le(o),u=f.layout({name:"fcose",quality:"proof",styleEnabled:!1,animate:!1,nodeDimensionsIncludeLabels:!1,idealEdgeLength(e){const[t,r]=e.connectedNodes(),{parent:i}=L(t),{parent:s}=L(r);return i===s?1.5*W("iconSize"):.5*W("iconSize")},edgeElasticity(e){const[t,r]=e.connectedNodes(),{parent:i}=L(t),{parent:s}=L(r);return i===s?.45:.001},alignmentConstraint:g,relativePlacementConstraint:p});u.one("layoutstop",(()=>{function e(e,t,r,i){let s,o;const{x:n,y:c}=e,{x:a,y:d}=t;o=(i-c+(n-r)*(c-d)/(n-a))/Math.sqrt(1+Math.pow((c-d)/(n-a),2)),s=Math.sqrt(Math.pow(i-c,2)+Math.pow(r-n,2)-Math.pow(o,2));s/=Math.sqrt(Math.pow(a-n,2)+Math.pow(d-c,2));let l=(a-n)*(i-c)-(d-c)*(r-n);switch(!0){case l>=0:l=1;break;case l<0:l=-1}let f=(a-n)*(r-n)+(d-c)*(i-c);switch(!0){case f>=0:f=1;break;case f<0:f=-1}return o=Math.abs(o)*l,s*=f,{distances:o,weights:s}}(0,a.K2)(e,"getSegmentWeights"),f.startBatch();for(const t of Object.values(f.edges()))if(t.data?.()){const{x:r,y:i}=t.source().position(),{x:s,y:o}=t.target().position();if(r!==s&&i!==o){const r=t.sourceEndpoint(),i=t.targetEndpoint(),{sourceDir:s}=S(t),[o,n]=k(s)?[r.x,i.y]:[i.x,r.y],{weights:c,distances:a}=e(r,i,o,n);t.style("segment-distances",a),t.style("segment-weights",c)}}f.endBatch(),u.run()})),u.run(),f.ready((e=>{a.Rm.info("Ready",e),c(f)}))}))}(0,i.pC)([{name:Q.prefix,icons:Q}]),l.A.use(f),(0,a.K2)(se,"addServices"),(0,a.K2)(oe,"addJunctions"),(0,a.K2)(ne,"positionNodes"),(0,a.K2)(ce,"addGroups"),(0,a.K2)(ae,"addEdges"),(0,a.K2)(de,"getAlignments"),(0,a.K2)(le,"getRelativeConstraints"),(0,a.K2)(fe,"layoutArchitecture");var he={parser:_,db:F,renderer:{draw:(0,a.K2)((async(e,t,r,i)=>{const s=i.db,o=s.getServices(),n=s.getJunctions(),d=s.getGroups(),l=s.getEdges(),f=s.getDataStructures(),h=(0,c.D)(t),g=h.append("g");g.attr("class","architecture-edges");const p=h.append("g");p.attr("class","architecture-services");const u=h.append("g");u.attr("class","architecture-groups"),await re(s,p,o),ie(s,p,n);const m=await fe(o,n,d,l,s,f);await ee(g,m),await te(u,m),ne(s,m),(0,a.ot)(void 0,h,W("padding"),W("useMaxWidth"))}),"draw")},styles:V}}}]);