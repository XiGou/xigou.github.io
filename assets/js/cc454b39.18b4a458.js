"use strict";(self.webpackChunkpersonal_blog=self.webpackChunkpersonal_blog||[]).push([["8045"],{50065:function(e,n,s){s.d(n,{Z:()=>i,a:()=>r});var l=s(67294);let c={},d=l.createContext(c);function r(e){let n=l.useContext(d);return l.useMemo(function(){return"function"==typeof e?e(n):{...n,...e}},[n,e])}function i(e){let n;return n=e.disableParentContext?"function"==typeof e.components?e.components(c):e.components||c:r(e.components),l.createElement(d.Provider,{value:n},e.children)}},61329:function(e,n,s){s.r(n),s.d(n,{frontMatter:()=>r,default:()=>x,contentTitle:()=>i,assets:()=>t,toc:()=>h,metadata:()=>l});var l=JSON.parse('{"id":"Zettelkasten/CNI plugin \u5B89\u88C5","title":"CNI plugin \u5B89\u88C5","description":"Kubernetes \u62A5\u9519 CNI plugin not initialized \u901A\u5E38\u8868\u793A \u5BB9\u5668\u7F51\u7EDC\u63A5\u53E3 (CNI) \u6CA1\u6709\u6B63\u786E\u5B89\u88C5\u6216\u521D\u59CB\u5316\uFF0C\u5BFC\u81F4 Pod \u5904\u4E8E ContainerCreating \u72B6\u6001\u3002\u53EF\u4EE5\u6309\u7167\u4EE5\u4E0B\u6B65\u9AA4\u8FDB\u884C\u6392\u67E5\u548C\u4FEE\u590D\uFF1A","source":"@site/knowledges/Zettelkasten/CNI plugin \u5B89\u88C5.md","sourceDirName":"Zettelkasten","slug":"/Zettelkasten/CNI plugin \u5B89\u88C5","permalink":"/knowledges/Zettelkasten/CNI plugin \u5B89\u88C5","draft":false,"unlisted":false,"tags":[],"version":"current","frontMatter":{},"sidebar":"readings","previous":{"title":"iscsiadm common commands","permalink":"/knowledges/UsefulSnipets/iscsiadm common commands"},"next":{"title":"dufs","permalink":"/knowledges/Zettelkasten/dufs"}}'),c=s(85893),d=s(50065);let r={},i=void 0,t={},h=[{value:"<strong>1. \u68C0\u67E5 CNI \u76F8\u5173 Pod \u662F\u5426\u8FD0\u884C</strong>",id:"1-\u68C0\u67E5-cni-\u76F8\u5173-pod-\u662F\u5426\u8FD0\u884C",level:2},{value:"<strong>2. \u786E\u4FDD\u8282\u70B9\u6709 CNI \u914D\u7F6E</strong>",id:"2-\u786E\u4FDD\u8282\u70B9\u6709-cni-\u914D\u7F6E",level:2},{value:"<strong>3. \u786E\u4FDD CNI \u4E8C\u8FDB\u5236\u6587\u4EF6\u5B58\u5728</strong>",id:"3-\u786E\u4FDD-cni-\u4E8C\u8FDB\u5236\u6587\u4EF6\u5B58\u5728",level:2},{value:"<strong>4. \u91CD\u65B0\u5B89\u88C5 CNI \u63D2\u4EF6</strong>",id:"4-\u91CD\u65B0\u5B89\u88C5-cni-\u63D2\u4EF6",level:2},{value:"<strong>5. \u68C0\u67E5 <code>kubelet</code> \u662F\u5426\u6B63\u5E38</strong>",id:"5-\u68C0\u67E5-kubelet-\u662F\u5426\u6B63\u5E38",level:2},{value:"<strong>6. \u91CD\u65B0\u521B\u5EFA <code>kubeadm</code> \u96C6\u7FA4</strong>",id:"6-\u91CD\u65B0\u521B\u5EFA-kubeadm-\u96C6\u7FA4",level:2},{value:"<strong>\u603B\u7ED3</strong>",id:"\u603B\u7ED3",level:2}];function o(e){let n={code:"code",h2:"h2",hr:"hr",li:"li",p:"p",pre:"pre",strong:"strong",table:"table",tbody:"tbody",td:"td",th:"th",thead:"thead",tr:"tr",ul:"ul",...(0,d.a)(),...e.components};return(0,c.jsxs)(c.Fragment,{children:[(0,c.jsxs)(n.p,{children:["Kubernetes \u62A5\u9519 ",(0,c.jsx)(n.strong,{children:(0,c.jsx)(n.code,{children:"CNI plugin not initialized"})})," \u901A\u5E38\u8868\u793A ",(0,c.jsx)(n.strong,{children:"\u5BB9\u5668\u7F51\u7EDC\u63A5\u53E3 (CNI) \u6CA1\u6709\u6B63\u786E\u5B89\u88C5\u6216\u521D\u59CB\u5316"}),"\uFF0C\u5BFC\u81F4 Pod \u5904\u4E8E ",(0,c.jsx)(n.code,{children:"ContainerCreating"})," \u72B6\u6001\u3002\u53EF\u4EE5\u6309\u7167\u4EE5\u4E0B\u6B65\u9AA4\u8FDB\u884C\u6392\u67E5\u548C\u4FEE\u590D\uFF1A"]}),"\n",(0,c.jsx)(n.hr,{}),"\n",(0,c.jsx)(n.h2,{id:"1-\u68C0\u67E5-cni-\u76F8\u5173-pod-\u662F\u5426\u8FD0\u884C",children:(0,c.jsx)(n.strong,{children:"1. \u68C0\u67E5 CNI \u76F8\u5173 Pod \u662F\u5426\u8FD0\u884C"})}),"\n",(0,c.jsxs)(n.p,{children:["\u9996\u5148\u68C0\u67E5 CNI \u76F8\u5173\u7684 DaemonSet\uFF08\u4F8B\u5982 ",(0,c.jsx)(n.code,{children:"calico"}),", ",(0,c.jsx)(n.code,{children:"flannel"}),", ",(0,c.jsx)(n.code,{children:"cilium"})," \u7B49\uFF09\u662F\u5426\u6B63\u5E38\uFF1A"]}),"\n",(0,c.jsx)(n.pre,{children:(0,c.jsx)(n.code,{className:"language-sh",children:"kubectl get pods -n kube-system\n"})}),"\n",(0,c.jsxs)(n.p,{children:["\u5982\u679C CNI \u76F8\u5173\u7684 Pod \u5904\u4E8E ",(0,c.jsx)(n.code,{children:"CrashLoopBackOff"})," \u6216 ",(0,c.jsx)(n.code,{children:"Pending"}),"\uFF0C\u5219\u8868\u793A CNI \u6CA1\u6709\u6B63\u786E\u542F\u52A8\u3002"]}),"\n",(0,c.jsx)(n.hr,{}),"\n",(0,c.jsx)(n.h2,{id:"2-\u786E\u4FDD\u8282\u70B9\u6709-cni-\u914D\u7F6E",children:(0,c.jsx)(n.strong,{children:"2. \u786E\u4FDD\u8282\u70B9\u6709 CNI \u914D\u7F6E"})}),"\n",(0,c.jsxs)(n.p,{children:["\u67E5\u770B ",(0,c.jsx)(n.code,{children:"/etc/cni/net.d/"})," \u662F\u5426\u6709 CNI \u914D\u7F6E\u6587\u4EF6\uFF1A"]}),"\n",(0,c.jsx)(n.pre,{children:(0,c.jsx)(n.code,{className:"language-sh",children:"ls -l /etc/cni/net.d/\n"})}),"\n",(0,c.jsx)(n.p,{children:"\u6B63\u5E38\u60C5\u51B5\u4E0B\u5E94\u6709 CNI \u914D\u7F6E\u6587\u4EF6\uFF0C\u4F8B\u5982\uFF1A"}),"\n",(0,c.jsx)(n.pre,{children:(0,c.jsx)(n.code,{className:"language-sh",children:"/etc/cni/net.d/10-calico.conflist\n"})}),"\n",(0,c.jsx)(n.p,{children:"\u5982\u679C\u6CA1\u6709\uFF0C\u8BF7\u91CD\u65B0\u5B89\u88C5 CNI \u63D2\u4EF6\u3002"}),"\n",(0,c.jsx)(n.hr,{}),"\n",(0,c.jsx)(n.h2,{id:"3-\u786E\u4FDD-cni-\u4E8C\u8FDB\u5236\u6587\u4EF6\u5B58\u5728",children:(0,c.jsx)(n.strong,{children:"3. \u786E\u4FDD CNI \u4E8C\u8FDB\u5236\u6587\u4EF6\u5B58\u5728"})}),"\n",(0,c.jsxs)(n.p,{children:["Kubelet \u9700\u8981\u5728 ",(0,c.jsx)(n.code,{children:"/opt/cni/bin/"})," \u76EE\u5F55\u627E\u5230 CNI \u53EF\u6267\u884C\u6587\u4EF6\uFF1A"]}),"\n",(0,c.jsx)(n.pre,{children:(0,c.jsx)(n.code,{className:"language-sh",children:"ls -l /opt/cni/bin/\n"})}),"\n",(0,c.jsx)(n.p,{children:"\u6B63\u5E38\u60C5\u51B5\u4E0B\u5E94\u8BE5\u5305\u542B\uFF1A"}),"\n",(0,c.jsxs)(n.ul,{children:["\n",(0,c.jsxs)(n.li,{children:["\n",(0,c.jsx)(n.p,{children:(0,c.jsx)(n.code,{children:"bridge"})}),"\n"]}),"\n",(0,c.jsxs)(n.li,{children:["\n",(0,c.jsx)(n.p,{children:(0,c.jsx)(n.code,{children:"host-local"})}),"\n"]}),"\n",(0,c.jsxs)(n.li,{children:["\n",(0,c.jsx)(n.p,{children:(0,c.jsx)(n.code,{children:"loopback"})}),"\n"]}),"\n",(0,c.jsxs)(n.li,{children:["\n",(0,c.jsx)(n.p,{children:(0,c.jsx)(n.code,{children:"calico"})}),"\n"]}),"\n",(0,c.jsxs)(n.li,{children:["\n",(0,c.jsx)(n.p,{children:(0,c.jsx)(n.code,{children:"flannel"})}),"\n"]}),"\n",(0,c.jsxs)(n.li,{children:["\n",(0,c.jsx)(n.p,{children:(0,c.jsx)(n.code,{children:"cilium"})}),"\n"]}),"\n",(0,c.jsxs)(n.li,{children:["\n",(0,c.jsxs)(n.p,{children:[(0,c.jsx)(n.code,{children:"weave"})," \u7B49"]}),"\n"]}),"\n"]}),"\n",(0,c.jsxs)(n.p,{children:["\u5982\u679C ",(0,c.jsx)(n.code,{children:"/opt/cni/bin/"})," \u4E3A\u7A7A\uFF0C\u5219 CNI \u6CA1\u6709\u6B63\u786E\u5B89\u88C5\uFF0C\u9700\u8981\u91CD\u65B0\u5B89\u88C5 CNI \u63D2\u4EF6\u3002"]}),"\n",(0,c.jsx)(n.hr,{}),"\n",(0,c.jsx)(n.h2,{id:"4-\u91CD\u65B0\u5B89\u88C5-cni-\u63D2\u4EF6",children:(0,c.jsx)(n.strong,{children:"4. \u91CD\u65B0\u5B89\u88C5 CNI \u63D2\u4EF6"})}),"\n",(0,c.jsxs)(n.p,{children:["\u5982\u679C\u4F60\u4F7F\u7528\u7684\u662F ",(0,c.jsx)(n.code,{children:"flannel"}),"\uFF1A"]}),"\n",(0,c.jsx)(n.pre,{children:(0,c.jsx)(n.code,{className:"language-sh",children:"kubectl apply -f https://raw.githubusercontent.com/coreos/flannel/master/Documentation/kube-flannel.yml\n"})}),"\n",(0,c.jsxs)(n.p,{children:["\u5982\u679C\u4F60\u4F7F\u7528\u7684\u662F ",(0,c.jsx)(n.code,{children:"calico"}),"\uFF1A"]}),"\n",(0,c.jsx)(n.pre,{children:(0,c.jsx)(n.code,{className:"language-sh",children:"kubectl apply -f https://docs.projectcalico.org/manifests/calico.yaml\n"})}),"\n",(0,c.jsxs)(n.p,{children:["\u5982\u679C\u4F60\u4F7F\u7528\u7684\u662F ",(0,c.jsx)(n.code,{children:"cilium"}),"\uFF1A"]}),"\n",(0,c.jsx)(n.pre,{children:(0,c.jsx)(n.code,{className:"language-sh",children:"kubectl apply -f https://raw.githubusercontent.com/cilium/cilium/v1.12/install/kubernetes/quick-install.yaml\n"})}),"\n",(0,c.jsx)(n.hr,{}),"\n",(0,c.jsx)(n.h2,{id:"5-\u68C0\u67E5-kubelet-\u662F\u5426\u6B63\u5E38",children:(0,c.jsxs)(n.strong,{children:["5. \u68C0\u67E5 ",(0,c.jsx)(n.code,{children:"kubelet"})," \u662F\u5426\u6B63\u5E38"]})}),"\n",(0,c.jsxs)(n.p,{children:["CNI \u63D2\u4EF6\u4F9D\u8D56 ",(0,c.jsx)(n.code,{children:"kubelet"}),"\uFF0C\u5982\u679C ",(0,c.jsx)(n.code,{children:"kubelet"})," \u6CA1\u6709\u6B63\u786E\u6307\u5B9A CNI \u76EE\u5F55\uFF0C\u5219\u4F1A\u5931\u8D25\uFF1A"]}),"\n",(0,c.jsx)(n.pre,{children:(0,c.jsx)(n.code,{className:"language-sh",children:"journalctl -u kubelet -f | grep cni\n"})}),"\n",(0,c.jsx)(n.p,{children:"\u5982\u679C\u770B\u5230\u5982\u4E0B\u62A5\u9519\uFF1A"}),"\n",(0,c.jsx)(n.pre,{children:(0,c.jsx)(n.code,{children:"failed to read CNI config /etc/cni/net.d: no such file or directory\n"})}),"\n",(0,c.jsxs)(n.p,{children:["\u5219\u8BF4\u660E CNI \u76EE\u5F55\u6CA1\u6709\u914D\u7F6E\u6B63\u786E\uFF0C\u9700\u8981\u91CD\u542F ",(0,c.jsx)(n.code,{children:"kubelet"}),"\uFF1A"]}),"\n",(0,c.jsx)(n.pre,{children:(0,c.jsx)(n.code,{className:"language-sh",children:"systemctl restart kubelet\n"})}),"\n",(0,c.jsx)(n.hr,{}),"\n",(0,c.jsx)(n.h2,{id:"6-\u91CD\u65B0\u521B\u5EFA-kubeadm-\u96C6\u7FA4",children:(0,c.jsxs)(n.strong,{children:["6. \u91CD\u65B0\u521B\u5EFA ",(0,c.jsx)(n.code,{children:"kubeadm"})," \u96C6\u7FA4"]})}),"\n",(0,c.jsx)(n.p,{children:"\u5982\u679C\u4ECD\u7136\u65E0\u6CD5\u89E3\u51B3\uFF0C\u53EF\u4EE5\u91CD\u7F6E Kubernetes \u5E76\u91CD\u65B0\u521D\u59CB\u5316\uFF1A"}),"\n",(0,c.jsx)(n.pre,{children:(0,c.jsx)(n.code,{className:"language-sh",children:"kubeadm reset -f\nkubeadm init --pod-network-cidr=192.168.0.0/16\n"})}),"\n",(0,c.jsx)(n.p,{children:"\u7136\u540E\u91CD\u65B0\u5B89\u88C5 CNI \u63D2\u4EF6\u3002"}),"\n",(0,c.jsx)(n.hr,{}),"\n",(0,c.jsx)(n.h2,{id:"\u603B\u7ED3",children:(0,c.jsx)(n.strong,{children:"\u603B\u7ED3"})}),"\n",(0,c.jsxs)(n.table,{children:[(0,c.jsx)(n.thead,{children:(0,c.jsxs)(n.tr,{children:[(0,c.jsx)(n.th,{children:(0,c.jsx)(n.strong,{children:"\u6B65\u9AA4"})}),(0,c.jsx)(n.th,{children:(0,c.jsx)(n.strong,{children:"\u68C0\u67E5\u5185\u5BB9"})}),(0,c.jsx)(n.th,{children:(0,c.jsx)(n.strong,{children:"\u4FEE\u590D\u65B9\u6CD5"})})]})}),(0,c.jsxs)(n.tbody,{children:[(0,c.jsxs)(n.tr,{children:[(0,c.jsx)(n.td,{children:(0,c.jsx)(n.strong,{children:"1. \u68C0\u67E5 CNI Pod"})}),(0,c.jsx)(n.td,{children:(0,c.jsx)(n.code,{children:"kubectl get pods -n kube-system"})}),(0,c.jsx)(n.td,{children:"\u91CD\u542F CNI Pod"})]}),(0,c.jsxs)(n.tr,{children:[(0,c.jsx)(n.td,{children:(0,c.jsx)(n.strong,{children:"2. \u68C0\u67E5 CNI \u914D\u7F6E"})}),(0,c.jsx)(n.td,{children:(0,c.jsx)(n.code,{children:"ls -l /etc/cni/net.d/"})}),(0,c.jsx)(n.td,{children:"\u91CD\u65B0\u5B89\u88C5 CNI"})]}),(0,c.jsxs)(n.tr,{children:[(0,c.jsx)(n.td,{children:(0,c.jsx)(n.strong,{children:"3. \u68C0\u67E5 CNI \u4E8C\u8FDB\u5236"})}),(0,c.jsx)(n.td,{children:(0,c.jsx)(n.code,{children:"ls -l /opt/cni/bin/"})}),(0,c.jsx)(n.td,{children:"\u4E0B\u8F7D CNI \u53EF\u6267\u884C\u6587\u4EF6"})]}),(0,c.jsxs)(n.tr,{children:[(0,c.jsx)(n.td,{children:(0,c.jsx)(n.strong,{children:"4. \u91CD\u65B0\u5B89\u88C5 CNI"})}),(0,c.jsx)(n.td,{children:(0,c.jsx)(n.code,{children:"kubectl apply -f <CNI YAML>"})}),(0,c.jsx)(n.td,{children:"\u91CD\u65B0\u5E94\u7528 CNI \u914D\u7F6E"})]}),(0,c.jsxs)(n.tr,{children:[(0,c.jsx)(n.td,{children:(0,c.jsx)(n.strong,{children:"5. \u68C0\u67E5 kubelet"})}),(0,c.jsx)(n.td,{children:"`journalctl -u kubelet -f"}),(0,c.jsx)(n.td,{children:"grep cni`"})]}),(0,c.jsxs)(n.tr,{children:[(0,c.jsx)(n.td,{children:(0,c.jsx)(n.strong,{children:"6. \u91CD\u65B0\u521D\u59CB\u5316"})}),(0,c.jsx)(n.td,{children:(0,c.jsx)(n.code,{children:"kubeadm reset && kubeadm init"})}),(0,c.jsx)(n.td,{children:"\u91CD\u65B0\u5B89\u88C5 CNI"})]})]})]}),"\n",(0,c.jsxs)(n.p,{children:["\uD83D\uDE80 ",(0,c.jsxs)(n.strong,{children:["\u4F60\u7528\u7684\u662F\u4EC0\u4E48 CNI \u63D2\u4EF6\uFF1F\u6709\u6CA1\u6709 ",(0,c.jsx)(n.code,{children:"kube-system"})," \u91CC\u7684 CNI Pod \u65E5\u5FD7\uFF1F"]})]})]})}function x(e={}){let{wrapper:n}={...(0,d.a)(),...e.components};return n?(0,c.jsx)(n,{...e,children:(0,c.jsx)(o,{...e})}):o(e)}}}]);