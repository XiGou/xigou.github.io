"use strict";(self.webpackChunkpersonal_blog=self.webpackChunkpersonal_blog||[]).push([["5870"],{98743:function(e,n,o){o.r(n),o.d(n,{default:()=>h,frontMatter:()=>s,metadata:()=>r,assets:()=>a,toc:()=>l,contentTitle:()=>c});var r=JSON.parse('{"id":"Clippings/Docker Cli Proxy configuration","title":"Proxy configuration","description":"How to configure the Docker client CLI to use a proxy server","source":"@site/collections/Clippings/Docker Cli Proxy configuration.md","sourceDirName":"Clippings","slug":"/Clippings/Docker Cli Proxy configuration","permalink":"/collections/Clippings/Docker Cli Proxy configuration","draft":false,"unlisted":false,"tags":[{"inline":true,"label":"clippings","permalink":"/collections/tags/clippings"}],"version":"current","frontMatter":{"title":"Proxy configuration","source":"https://docs.docker.com/engine/cli/proxy/","author":["[[Docker Documentation]]"],"published":"2024-11-05T00:00:00.000Z","created":"2025-03-10T00:00:00.000Z","description":"How to configure the Docker client CLI to use a proxy server","tags":["clippings"]},"sidebar":"readings","previous":{"title":"Daemon proxy configuration","permalink":"/collections/Clippings/Daemon proxy configuration"},"next":{"title":"Your next developer desktop with Ubuntu 24.04 and TigerVNC on OCI","permalink":"/collections/Clippings/Your next developer desktop with Ubuntu 24.04 and TigerVNC on OCI"}}'),i=o("85893"),t=o("50065");let s={title:"Proxy configuration",source:"https://docs.docker.com/engine/cli/proxy/",author:["[[Docker Documentation]]"],published:new Date("2024-11-05T00:00:00.000Z"),created:new Date("2025-03-10T00:00:00.000Z"),description:"How to configure the Docker client CLI to use a proxy server",tags:["clippings"]},c=void 0,a={},l=[{value:"Configure the Docker client",id:"configure-the-docker-client",level:2},{value:"Run containers with a proxy configuration",id:"run-containers-with-a-proxy-configuration",level:3},{value:"Build with a proxy configuration",id:"build-with-a-proxy-configuration",level:3},{value:"Configure proxy settings per daemon",id:"configure-proxy-settings-per-daemon",level:3},{value:"Set proxy using the CLI",id:"set-proxy-using-the-cli",level:2},{value:"Proxy as environment variable for builds",id:"proxy-as-environment-variable-for-builds",level:2}];function d(e){let n={a:"a",blockquote:"blockquote",code:"code",h2:"h2",h3:"h3",hr:"hr",li:"li",p:"p",pre:"pre",strong:"strong",table:"table",tbody:"tbody",td:"td",th:"th",thead:"thead",tr:"tr",ul:"ul",...(0,t.a)(),...e.components};return(0,i.jsxs)(i.Fragment,{children:[(0,i.jsx)(n.p,{children:"Table of contents"}),"\n",(0,i.jsx)(n.hr,{}),"\n",(0,i.jsx)(n.p,{children:"This page describes how to configure the Docker CLI to use proxies via environment variables in containers."}),"\n",(0,i.jsxs)(n.p,{children:["This page doesn't describe how to configure proxies for Docker Desktop. For instructions, see ",(0,i.jsx)(n.a,{href:"https://docs.docker.com/desktop/settings-and-maintenance/settings/#proxies",children:"configuring Docker Desktop to use HTTP/HTTPS proxies"}),"."]}),"\n",(0,i.jsxs)(n.p,{children:["If you're running Docker Engine without Docker Desktop, refer to ",(0,i.jsx)(n.a,{href:"https://docs.docker.com/engine/daemon/proxy/",children:"Configure the Docker daemon to use a proxy"})," to learn how to configure a proxy server for the Docker daemon (",(0,i.jsx)(n.code,{children:"dockerd"}),") itself."]}),"\n",(0,i.jsx)(n.p,{children:"If your container needs to use an HTTP, HTTPS, or FTP proxy server, you can configure it in different ways:"}),"\n",(0,i.jsxs)(n.ul,{children:["\n",(0,i.jsx)(n.li,{children:(0,i.jsx)(n.a,{href:"https://docs.docker.com/engine/cli/proxy/#configure-the-docker-client",children:"Configure the Docker client"})}),"\n",(0,i.jsx)(n.li,{children:(0,i.jsx)(n.a,{href:"https://docs.docker.com/engine/cli/proxy/#set-proxy-using-the-cli",children:"Set proxy using the CLI"})}),"\n"]}),"\n",(0,i.jsxs)(n.blockquote,{children:["\n",(0,i.jsx)(n.p,{children:(0,i.jsx)(n.strong,{children:"Note"})}),"\n",(0,i.jsx)(n.p,{children:"Unfortunately, there's no standard that defines how web clients should handle proxy environment variables, or the format for defining them."}),"\n",(0,i.jsxs)(n.p,{children:["If you're interested in the history of these variables, check out this blog post on the subject, by the GitLab team: ",(0,i.jsx)(n.a,{href:"https://about.gitlab.com/blog/2021/01/27/we-need-to-talk-no-proxy/",children:"We need to talk: Can we standardize NO_PROXY?"}),"."]}),"\n"]}),"\n",(0,i.jsx)(n.h2,{id:"configure-the-docker-client",children:"Configure the Docker client"}),"\n",(0,i.jsxs)(n.p,{children:["You can add proxy configurations for the Docker client using a JSON configuration file, located in ",(0,i.jsx)(n.code,{children:"~/.docker/config.json"}),". Builds and containers use the configuration specified in this file."]}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{className:"language-json",children:'{\n "proxies": {\n   "default": {\n     "httpProxy": "http://proxy.example.com:3128",\n     "httpsProxy": "https://proxy.example.com:3129",\n     "noProxy": "*.test.example.com,.example.org,127.0.0.0/8"\n   }\n }\n}\n'})}),"\n",(0,i.jsxs)(n.blockquote,{children:["\n",(0,i.jsx)(n.p,{children:(0,i.jsx)(n.strong,{children:"Warning"})}),"\n",(0,i.jsx)(n.p,{children:"Proxy settings may contain sensitive information. For example, some proxy servers require authentication information to be included in their URL, or their address may expose IP-addresses or hostnames of your company's environment."}),"\n",(0,i.jsxs)(n.p,{children:["Environment variables are stored as plain text in the container's configuration, and as such can be inspected through the remote API or committed to an image when using ",(0,i.jsx)(n.code,{children:"docker commit"}),"."]}),"\n"]}),"\n",(0,i.jsx)(n.p,{children:"The configuration becomes active after saving the file, you don't need to restart Docker. However, the configuration only applies to new containers and builds, and doesn't affect existing containers."}),"\n",(0,i.jsx)(n.p,{children:"The following table describes the available configuration parameters."}),"\n",(0,i.jsxs)(n.table,{children:[(0,i.jsx)(n.thead,{children:(0,i.jsxs)(n.tr,{children:[(0,i.jsx)(n.th,{children:"Property"}),(0,i.jsx)(n.th,{children:"Description"})]})}),(0,i.jsxs)(n.tbody,{children:[(0,i.jsxs)(n.tr,{children:[(0,i.jsx)(n.td,{children:(0,i.jsx)(n.code,{children:"httpProxy"})}),(0,i.jsxs)(n.td,{children:["Sets the ",(0,i.jsx)(n.code,{children:"HTTP_PROXY"})," and ",(0,i.jsx)(n.code,{children:"http_proxy"})," environment variables and build arguments."]})]}),(0,i.jsxs)(n.tr,{children:[(0,i.jsx)(n.td,{children:(0,i.jsx)(n.code,{children:"httpsProxy"})}),(0,i.jsxs)(n.td,{children:["Sets the ",(0,i.jsx)(n.code,{children:"HTTPS_PROXY"})," and ",(0,i.jsx)(n.code,{children:"https_proxy"})," environment variables and build arguments."]})]}),(0,i.jsxs)(n.tr,{children:[(0,i.jsx)(n.td,{children:(0,i.jsx)(n.code,{children:"ftpProxy"})}),(0,i.jsxs)(n.td,{children:["Sets the ",(0,i.jsx)(n.code,{children:"FTP_PROXY"})," and ",(0,i.jsx)(n.code,{children:"ftp_proxy"})," environment variables and build arguments."]})]}),(0,i.jsxs)(n.tr,{children:[(0,i.jsx)(n.td,{children:(0,i.jsx)(n.code,{children:"noProxy"})}),(0,i.jsxs)(n.td,{children:["Sets the ",(0,i.jsx)(n.code,{children:"NO_PROXY"})," and ",(0,i.jsx)(n.code,{children:"no_proxy"})," environment variables and build arguments."]})]}),(0,i.jsxs)(n.tr,{children:[(0,i.jsx)(n.td,{children:(0,i.jsx)(n.code,{children:"allProxy"})}),(0,i.jsxs)(n.td,{children:["Sets the ",(0,i.jsx)(n.code,{children:"ALL_PROXY"})," and ",(0,i.jsx)(n.code,{children:"all_proxy"})," environment variables and build arguments."]})]})]})]}),"\n",(0,i.jsxs)(n.p,{children:["These settings are used to configure proxy environment variables for containers only, and not used as proxy settings for the Docker CLI or the Docker Engine itself. Refer to the ",(0,i.jsx)(n.a,{href:"https://docs.docker.com/reference/cli/docker/#environment-variables",children:"environment variables"})," and ",(0,i.jsx)(n.a,{href:"https://docs.docker.com/engine/daemon/proxy/",children:"configure the Docker daemon to use a proxy server"})," sections for configuring proxy settings for the CLI and daemon."]}),"\n",(0,i.jsx)(n.h3,{id:"run-containers-with-a-proxy-configuration",children:"Run containers with a proxy configuration"}),"\n",(0,i.jsxs)(n.p,{children:["When you start a container, its proxy-related environment variables are set to reflect your proxy configuration in ",(0,i.jsx)(n.code,{children:"~/.docker/config.json"}),"."]}),"\n",(0,i.jsxs)(n.p,{children:["For example, assuming a proxy configuration like the example shown in the ",(0,i.jsx)(n.a,{href:"https://docs.docker.com/engine/cli/proxy/#configure-the-docker-client",children:"earlier section"}),", environment variables for containers that you run are set as follows:"]}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{className:"language-console",children:"$ docker run --rm alpine sh -c 'env | grep -i  _PROXY'\nhttps_proxy=http://proxy.example.com:3129\nHTTPS_PROXY=http://proxy.example.com:3129\nhttp_proxy=http://proxy.example.com:3128\nHTTP_PROXY=http://proxy.example.com:3128\nno_proxy=*.test.example.com,.example.org,127.0.0.0/8\nNO_PROXY=*.test.example.com,.example.org,127.0.0.0/8\n"})}),"\n",(0,i.jsx)(n.h3,{id:"build-with-a-proxy-configuration",children:"Build with a proxy configuration"}),"\n",(0,i.jsx)(n.p,{children:"When you invoke a build, proxy-related build arguments are pre-populated automatically, based on the proxy settings in your Docker client configuration file."}),"\n",(0,i.jsxs)(n.p,{children:["Assuming a proxy configuration like the example shown in the ",(0,i.jsx)(n.a,{href:"https://docs.docker.com/engine/cli/proxy/#configure-the-docker-client",children:"earlier section"}),", environment are set as follows during builds:"]}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{className:"language-console",children:"$ docker build \\\n  --no-cache \\\n  --progress=plain \\\n  - <<EOF\nFROM alpine\nRUN env | grep -i _PROXY\nEOF\n"})}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{className:"language-console",children:"#5 [2/2] RUN env | grep -i _PROXY\n#5 0.100 HTTPS_PROXY=https://proxy.example.com:3129\n#5 0.100 no_proxy=*.test.example.com,.example.org,127.0.0.0/8\n#5 0.100 NO_PROXY=*.test.example.com,.example.org,127.0.0.0/8\n#5 0.100 https_proxy=https://proxy.example.com:3129\n#5 0.100 http_proxy=http://proxy.example.com:3128\n#5 0.100 HTTP_PROXY=http://proxy.example.com:3128\n#5 DONE 0.1s\n"})}),"\n",(0,i.jsx)(n.h3,{id:"configure-proxy-settings-per-daemon",children:"Configure proxy settings per daemon"}),"\n",(0,i.jsxs)(n.p,{children:["The ",(0,i.jsx)(n.code,{children:"default"})," key under ",(0,i.jsx)(n.code,{children:"proxies"})," in ",(0,i.jsx)(n.code,{children:"~/.docker/config.json"})," configures the proxy settings for all daemons that the client connects to. To configure the proxies for individual daemons, use the address of the daemon instead of the ",(0,i.jsx)(n.code,{children:"default"})," key."]}),"\n",(0,i.jsxs)(n.p,{children:["The following example configures both a default proxy config, and a no-proxy override for the Docker daemon on address ",(0,i.jsx)(n.code,{children:"tcp://docker-daemon1.example.com"}),":"]}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{className:"language-json",children:'{\n "proxies": {\n   "default": {\n     "httpProxy": "http://proxy.example.com:3128",\n     "httpsProxy": "https://proxy.example.com:3129",\n     "noProxy": "*.test.example.com,.example.org,127.0.0.0/8"\n   },\n   "tcp://docker-daemon1.example.com": {\n     "noProxy": "*.internal.example.net"\n   }\n }\n}\n'})}),"\n",(0,i.jsx)(n.h2,{id:"set-proxy-using-the-cli",children:"Set proxy using the CLI"}),"\n",(0,i.jsxs)(n.p,{children:["Instead of ",(0,i.jsx)(n.a,{href:"https://docs.docker.com/engine/cli/proxy/#configure-the-docker-client",children:"configuring the Docker client"}),", you can specify proxy configurations on the command-line when you invoke the ",(0,i.jsx)(n.code,{children:"docker build"})," and ",(0,i.jsx)(n.code,{children:"docker run"})," commands."]}),"\n",(0,i.jsxs)(n.p,{children:["Proxy configuration on the command-line uses the ",(0,i.jsx)(n.code,{children:"--build-arg"})," flag for builds, and the ",(0,i.jsx)(n.code,{children:"--env"})," flag for when you want to run containers with a proxy."]}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{className:"language-console",children:'$ docker build --build-arg HTTP_PROXY="http://proxy.example.com:3128" .\n$ docker run --env HTTP_PROXY="http://proxy.example.com:3128" redis\n'})}),"\n",(0,i.jsxs)(n.p,{children:["For a list of all the proxy-related build arguments that you can use with the ",(0,i.jsx)(n.code,{children:"docker build"})," command, see ",(0,i.jsx)(n.a,{href:"https://docs.docker.com/reference/dockerfile/#predefined-args",children:"Predefined ARGs"}),". These proxy values are only available in the build container. They're not included in the build output."]}),"\n",(0,i.jsx)(n.h2,{id:"proxy-as-environment-variable-for-builds",children:"Proxy as environment variable for builds"}),"\n",(0,i.jsxs)(n.p,{children:["Don't use the ",(0,i.jsx)(n.code,{children:"ENV"})," Dockerfile instruction to specify proxy settings for builds. Use build arguments instead."]}),"\n",(0,i.jsx)(n.p,{children:"Using environment variables for proxies embeds the configuration into the image. If the proxy is an internal proxy, it might not be accessible for containers created from that image."}),"\n",(0,i.jsx)(n.p,{children:"Embedding proxy settings in images also poses a security risk, as the values may include sensitive information."})]})}function h(e={}){let{wrapper:n}={...(0,t.a)(),...e.components};return n?(0,i.jsx)(n,{...e,children:(0,i.jsx)(d,{...e})}):d(e)}},50065:function(e,n,o){o.d(n,{Z:function(){return c},a:function(){return s}});var r=o(67294);let i={},t=r.createContext(i);function s(e){let n=r.useContext(t);return r.useMemo(function(){return"function"==typeof e?e(n):{...n,...e}},[n,e])}function c(e){let n;return n=e.disableParentContext?"function"==typeof e.components?e.components(i):e.components||i:s(e.components),r.createElement(t.Provider,{value:n},e.children)}}}]);